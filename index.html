<!DOCTYPE html><html><head>
<link rel="stylesheet" type="text/css" href="css/base.css">
<link rel="stylesheet" type="text/css" href="css/zoom/base.css">
<link rel="stylesheet" type="text/css" href="css/zoom/projects.css">
<link rel="stylesheet" type="text/css" href="css/zoom/imgareaselect-default.css">
<link rel="stylesheet" type="text/css" href="css/zoom/index.css">
<link rel="stylesheet" type="text/css" href="css/zoom/zoom.css">
<link rel="stylesheet" href="Reciever/style.css">


<script type="text/javascript">
//LOAD JS FILE
function loadJavaScriptSync(filePath)
{
    var req = new XMLHttpRequest();
    req.open("GET", filePath, false); // 'false': synchronous.
    req.send(null);

    var headElement = document.getElementsByTagName("head")[0];
    var newScriptElement = document.createElement("script");
    newScriptElement.type = "text/javascript";
    newScriptElement.text = req.responseText;
    headElement.appendChild(newScriptElement);
}

//SOUND SIGNALS
function soundClick(s) {
  var audio = new Audio();
  audio.src = './src/'+s+'.mp3';
  audio.autoplay = true; 
}


var zoomX = 0;
var zoomY = 0;
var zoomW = 0;
var zoomH = 0;
var flagON = 0;

function selZM(id){
	var selZBTN=document.getElementById("selZBTN");
	if(flagON==0){loadJavaScriptSync("js/zoom/zoom.js"); flagON=1; selZBTN.innerHTML="EDIT ON";}else{flagON=0; selZBTN.innerHTML="EDIT OFF";}
}



//Screen Resolution
const availableScreenWidth = window.screen.availWidth;
const availableScreenHeight = window.screen.availHeight;
//var wX = availableScreenWidth-300;
var wX = availableScreenWidth;
var wY = availableScreenHeight;

wX=1040; wY=700;

var gameStatus=0;


//P2P
//var lastPeerId = null;
//var peer = null; // own peer object
//var conn = null;

var onlineStatus = 0;


//Mouse XY
var ex=0;
var ey=0;

//Mouse object XY
var mX=0;
var mY=0;


//LEVEL XYZ
var xS=0;yS=0;
var x=0;// DB index
var zzT=0; //SCR PART
var oneStep=0; oneStep0=0; oneStep1=0; oneStep2=0; oneStep3=0;

var subP=0;

//X Y W H parameters
var xSL=0; ySL=0; roundX=0; roundY=0; rSL=0; countSLX=0; countSLY=0;  secZ=0;   brX1=0; brX2=0; brY1=0; brY2=0;
var stepSL=10*4;
//Slide
var xy=0; //Move side


var xCOR = 0;
var yCOR = 0;
var xCR = 0; 
var yCR = 0;

var monX=0;

//Timer
var secZ=0;
var minZ=0;

var s=0;
var stpTmr=0;
var slideSec=0;

//Draw option
var dotSizeW=10;
var dotSizeH=10;
var penD=0;
var eraserS=0;

//Mouse wheel zoom
var oZOOM=0;
var testD=0;

//Local
var l_ip;
var l_mac;
var ses_id;


var xFMC=0;yFMC=0; //TARGET X Y

var colorN="#000000"; 

//Random digit
function randRange (min, max)
{
	return Math.round( Math.random() * (max - min) + min );	
}


//TEST DRAW BASE 64
function imageBASE64(data)
{	
	runingFun("imageB64");
	var canvas = document.getElementById("container");
	var ctx = canvas.getContext("2d");

	var image = new Image();
	image.onload = function() {
	  ctx.drawImage(image, 0, 0);
	};
	
	image.src = "data:image/jpg;base64,"+data;	
}



var saveScr=0;
function saveSCR(){saveScr=1;}



//DRAW IMAGE IN CANVAS 
var canvasIMAGE=0;
var canvasIMGW=0;
var canvasIMGH=0;
function imageInCanvas(can,imgU,x,y,w,h)
{	
	runingFun("imageInCanvas");

	canvasIMAGE = imgU;
	
	var canvas = document.getElementById(can); //container
	var ctx = canvas.getContext("2d");
	
	var image = new Image(0, 0);
	image.onload = drawImageActualSize;
	image.src = imgU;
	
	function drawImageActualSize() 
	{
		canvas.width = this.naturalWidth;
		canvas.height = this.naturalHeight;

		if(w<=0)
		{	  
			canvasIMGW = this.naturalWidth;
			canvasIMGH = this.naturalHeight;
		}
		else
		{
		   canvasIMGW=w;
		   canvasIMGH=h;
		}  

		if(zoomX != 0){x=zoomX; y=zoomY; canvasIMGW=zoomW; canvasIMGH=zoomH;}else{}

		ctx.drawImage(this, x, y, canvasIMGW, canvasIMGH);
	}
}


//DO RAND OBJECTS
var objPOS;
function doRandOBJ(strD,xx,yy)
{	
	runingFun("doRandOBJ");	
	var myArray = strD.split('|');
	for(n=1;n<35;n++)
	{
		var strX = myArray[n];
		var strY = myArray[n+1];
		var numbX = Number(strX);
		var numbY = Number(strY);		
		var c=document.getElementById("container");
		var ctx=c.getContext("2d");	
		ctx.clearRect(0, 0, 2200, 1200);	
		var xxb = (numbX+xx);
		var yyb = (numbY+yy);
		for(nn=1;nn<35;nn++)
		{					
			var strXN = myArray[nn];
			var strYN = myArray[nn+1];
			var numbXN = Number(strXN);
			var numbYN = Number(strYN);
			var xxbn = (numbXN+xx);
			var yybn = (numbYN+yy);
			var dmtr = 6;		
			if(nn<25) {var xxbn =  (numbXN+xx+70); dmtr=3;} 
			if(nn>25) {var xxbn =  (numbXN-xx); dmtr=3;} 	
			//Star Animation effect
			if(nn==4) {var xxbn =  (numbXN+xx/3);}
			if(nn==9) {var xxbn =  (numbXN+xx/6);}
			if(nn==20){var xxbn =  (numbXN+xx/9);}
			if(nn>10 && nn<19) {var xxbn =  (numbXN+xx/2); dmtr=4;}
			if(nn>20 && nn<25) {var xxbn =  (numbXN+xx/4); dmtr=2;}
			if(nn>30) {var xxbn =  (numbXN+xx/10); dmtr=1;}	
			ctx.beginPath();
			ctx.fillStyle = "#4297AE";
			ctx.arc(xxbn, yybn, dmtr, 0, 2 * Math.PI);
			ctx.fill();				
		}	
	}
}



//USER LIST
var usrL=0;
function userLIST()
{	
	runingFun("userLIST"); 
	//USER COUNT
	var fs = require('fs');
	var data = fs.readFileSync('./db/SERVER.txt').toString();
	var cnt = data.split('\n').length;
	//alert(data);
	
	var firstDiv5=document.getElementById('USER_LIST');
	firstDiv5.innerHTML='';
	
	var baseX = data.toString();
	var myArr = baseX.split(";");
	var length = myArr.length;

	for(var n=0;n<length-1;n++)
	{		
		var a5 = document.getElementsByTagName('div');
		var body=document.getElementsByTagName('body')[0];
		var newDiv5 = document.createElement('div');
		var firstElem5=firstDiv5.getElementsByTagName('div')[0];
		
		var divNum5 = a5.length;
		usrL=usrL+1;
		
		var t1 = myArr[n].toString();	
		var myArr2 = t1.split("|");
		var srvN = myArr2[0];
		var cntX = myArr2[1];
		var cntY = myArr2[2];
		
		newDiv5.className = 'range_box_layer';	
		newDiv5.id = divNum5;
		newDiv5.style.backgroundColor = '#CBEBFF';
		newDiv5.innerHTML = '<span id="cn_'+cntX+'" class="btnLnk" style="height:20%;" onclick=ConX("'+cntX+'");return false>'+"["+srvN+"] "+cntX+"|"+cntY+'</span>';
		firstDiv5.insertBefore(newDiv5,firstElem5);	
		//body.appendChild(newDiv);

		var unum=document.getElementById('unum');
		unum.innerHTML = usrL;	
	}	
}


var sesionID;
function ConX(c){
	var recvIdInput = document.getElementById("receiver-id");
	recvIdInput.value=c;	
	sesionID=c;
}


//ADD NEW USER
function addServer(id){
	var fs = require('fs');
	var logStream = fs.createWriteStream('./db/SERVER.txt', { flags: 'a' }); //ADD BLOG
	var newLineChar = process.platform === 'win32' ? '\r\n' : '\n';
	var servID= id+"|"+l_ip+"|"+l_mac+";"+newLineChar;
	logStream.write(servID);
	logStream.end();
}



var statusBACK=0;
var topicID=0;
function topic(t)
{
	topicID = t;
	
	var postTTLINP=document.getElementById('sBlogTitle');
	postTTLINP.style.display="none";
	var sBlogCnt=document.getElementById('sBlogCnt');
	sBlogCnt.style.height="170px";
	
	//ID COUNT
	var fs = require('fs');
	var data = fs.readFileSync('./db/topics/'+t+'.txt').toString();

	var cnt = data.split('\n').length;
	
	var firstDiv4=document.getElementById('SITE');
	firstDiv4.innerHTML="";
	var btnBACK = document.getElementById('btnBACK');
	btnBACK.style.display="block";
	statusBACK=0;
	
	var baseX = data.toString();
	var myArr = baseX.split("^"); //;
	var length = myArr.length;

	for(var n=0;n<length-1;n++)
	{
		var a4 = document.getElementsByTagName('div');
		var body=document.getElementsByTagName('body')[0];
		var newDiv4 = document.createElement('div');

		firstDiv4.style.display="block";
		var firstElem4=firstDiv4.getElementsByTagName('div')[0];

		var divNum4 = a4.length;

		var t1 = myArr[n];	
		var myArr2 = t1.split("|");
		var cnt = myArr2[0];
		var postContent = myArr[n];
		postContent = postContent.replace(/;/g, '&#59;');
		
		newDiv4.className = 'range_box_layer';	
		newDiv4.id = divNum4;
		//newDiv4.style.backgroundColor = '#CBEBFF';
		newDiv4.innerHTML = '<div class="btnLnk" style="height:20%;" onclick=topic('+t+');return false>TOPIC ID: '+t+' | <p style="width:60%;">'+postContent+'</p></div>';
		firstDiv4.insertBefore(newDiv4,firstElem4);	
		//body.appendChild(newDiv);
	}	
}




function goSite(s){
	var fs = require("fs");	 
	var fileNM = "./sites/"+s;
	
	var firstDiv4=document.getElementById('TOPIC');
	firstDiv4.style.display = 'none';
	
	fs.readFile(fileNM, function(error,data)
	{ 
		if(error) {
			return console.log(error);			
		}
			for(var n=0;n<1;n++)
			{
				//alert(s);
			}	
			
			if(s=="CHAT.txt")
			{
				var chatCP = document.getElementById('CHAT_CP');
				chatCP.style.display="block";
				var blogCP = document.getElementById('BLOG_CP');
				blogCP.style.display="none";
				
				//test full chat
				var messageCP = document.getElementById('mesChat');
				const element = document.getElementById("fullChatPanel");
				const rect = element.getBoundingClientRect();				
				//messageCP.style.height=rect.y+"px";
				messageCP.style.height="600px";
			}

			if(s=="BLOG.txt")
			{						
				var postTTLINP=document.getElementById('sBlogTitle');
				postTTLINP.style.display="block";
				var sBlogCnt=document.getElementById('sBlogCnt');
				sBlogCnt.style.height="120px";
				var blogCP = document.getElementById('BLOG_CP');
				var cp1 = document.getElementById("BOTBAR_1");
				var chatCP = document.getElementById('CHAT_CP');
				var forumCP = document.getElementById('FORUM_1');
				blogCP.style.display="block";
				forumCP.style.display="block";
				cp1.style.bottom = "200px";
				chatCP.style.display="none";
				var firstDiv4=document.getElementById('SITE');
					firstDiv4.innerHTML="";	
				var baseX = data.toString();
				var myArr = baseX.split("^"); //;
				var length = myArr.length;
					
				for(var n=0;n<length-1;n++)
				{					
					var a4 = document.getElementsByTagName('div');
					var body=document.getElementsByTagName('body')[0];
					var newDiv4 = document.createElement('div');
					
					firstDiv4.style.display="block";
					var firstElem4=firstDiv4.getElementsByTagName('div')[0];					
					var divNum4 = a4.length;				
					var t1 = myArr[n];	
					var myArr2 = t1.split("|");
					var cnt = myArr2[0];
					var bT = myArr2[1];
					
					newDiv4.className = 'range_box_layer';	
					newDiv4.id = divNum4;
					//newDiv4.style.backgroundColor = '#CBEBFF';
					newDiv4.innerHTML = '<span class="btnLnk" onclick="javascript:topic('+cnt+');return false"> '+cnt+' |[ BLOG ] '+bT+'</span>';
					firstDiv4.insertBefore(newDiv4,firstElem4);	
					//body.appendChild(newDiv);					
				}				
			}
			else
			{			
				var siteB = document.getElementById('SITE');
				siteB.style.display="block";
				siteB.innerHTML=data;			
			}
	});
}



var chatFS=0;
function fullChatOPN(){
	if(chatFS==0){chatFS=1; var icnC='&#10064';}else{chatFS=0; var icnC='&#10060;';}
	var forumCP = document.getElementById('FORUM');
	forumCP.style.display="block";
	forumCP.style.height = "800px";
	var chtOC = document.getElementById('chatOC');
	chtOC.innerHTML=icnC;
}




function doBlogDIV(t)
{	
	//ID COUNT
	var fs = require('fs');
	var data = fs.readFileSync('./sites/BLOG.txt').toString();	
	
	//var dataR = data.replace(/&#59;/g, ';');
	
	var cnt = data.split('\n').length;	
	var firstDiv4=document.getElementById('SITE');
	var a4 = document.getElementsByTagName('div');
	var body=document.getElementsByTagName('body')[0];
	var newDiv4 = document.createElement('div');
	firstDiv4.style.display="block";
	var firstElem4=firstDiv4.getElementsByTagName('div')[0];
	var divNum4 = a4.length;
	newDiv4.className = 'range_box_layer';	
	newDiv4.id = divNum4;
	newDiv4.style.backgroundColor = '#CBEBFF';
	newDiv4.innerHTML = '<span class="btnLnk" onclick=topic('+cnt+');return false>NEW [ BLOG ]: '+cnt+'| '+t+'</span>';
	firstDiv4.insertBefore(newDiv4,firstElem4);	
	//body.appendChild(newDiv);
}



//ADD IN BLOG DB
function newBLOG(s,s2)
{
	//ID COUNT
	var fs = require('fs');
	var data = fs.readFileSync('./sites/BLOG.txt').toString();
	var cnt = data.split('\n').length;	
	var newLineChar = process.platform === 'win32' ? '\r\n' : '\n';
	var blogPost= cnt+"|"+s+"|"+s2+"^"+newLineChar;  //&#59; = ;
	var topicPost= cnt+"|"+s+"|"+s2+"^"+newLineChar;		
	//WRITE IN BLOG DB OR TOPIC
	if(topicID==0)
	{
		var logStream = fs.createWriteStream('./sites/BLOG.txt', { flags: 'a' }); //ADD BLOG
		var logStream2 = fs.createWriteStream('./db/topics/'+cnt+'.txt', { flags: 'a' }); //ADD TOPIC
		logStream.write(blogPost);
		logStream2.write(topicPost);
		logStream.end();
		logStream2.end();
		topicID=0;
	}
	else
	{
		var logStream2 = fs.createWriteStream('./db/topics/'+topicID+'.txt', { flags: 'a' }); //ADD TOPIC
		logStream2.write(topicPost);
		logStream2.end();
		topicID=topicID;
	}	
}




//MEDIA PLAYER
var canSizeW=1000;
var nowPLay=0;

var vidWR = 0;
var vidHR = 0;

var sTime=0;
function linkBlob(n){

	imageInCanvas("container",'./images/A.png',0,0,0,0);
		
	var medPL = document.getElementById("mediaPL");
	medPL.style.display="block";	
			
	var vidTest = document.getElementById("myVideo");
	vidTest.src = "./media/"+n;		
			
	var vid = document.getElementById("videoBLOB");
	vid.src = "./media/"+n;
	
	var canvasVID = document.getElementById("canvas3");
	canvasVID.style.visibility="visible";
	var ctxVID = canvasVID.getContext("2d");

	
	//alert("VIDEO W:"+vidWR+"H: "+vidHR); 
	//if(vidWR>=1600){vidWR=vidWR/2; vidHR=vidHR/2;} //Max video Width
	if(vidHR>=600 || vidWR>=1600){vidHR=vidHR/2; vidWR=vidWR/2;}else{vidWR=vidWR; vidHR=vidHR;} //Max video Hight
		
		
	ctxVID.clearRect(0, 0, 2000, 2000);	
	
	
	var cw = (canvasVID.width);
	var ch = (canvasVID.height);
		
	vid.addEventListener("seeking", function(event) {
		console.log("User is seeking to a new position:", event.target.currentTime);
		sTime = event.target.currentTime;
		if (sTime <= 4000) ctxVID.drawImage(vid, 0, 0, vidWR, vidHR);
	});

	//Set current time
	vid.currentTime = 0;
	
	vid.addEventListener(
	  "play",
	  () => {
		paintVideo(vid, ctxVID, cw, ch);
		imageInCanvas("container",'./images/A.png',0,0, vidWR, vidHR);
		//sTime = vid.currentTime;
	  },
	  false
	);

	function paintVideo() 
	{
		requestAnimationFrame(paintVideo);
		//paused or ended return
		if (vid.paused || vid.ended) {

		return;
	}	
		//paint the video on the canvas
		if (vid.currentTime <= 4000) ctxVID.drawImage(vid, 0, 0, vidWR, vidHR); 
	}

	nowPLay=n;
}




//SAVE POINT
function addPoint(){
	var fs = require("fs");			
	var pointDB="./db/point.txt";
	var levelKey = xS+":"+yS+";";
	//fs.writeFileSync(pointDB, levelKey);
	
	//var data = fs.readFileSync('./db/point.txt').toString();
	//var cnt = data.split('\n').length;	
	var newLineChar = process.platform === 'win32' ? '\r\n' : '\n';
	//var newPoint= cnt+"|"+s+"|"+s2+"^"+newLineChar;  //&#59; = ;	
	//WRITE IN BLOG DB OR TOPIC
	var levelKey = levelKey+"^"+newLineChar;

	var logStream = fs.createWriteStream('./db/point.txt', { flags: 'a' }); //ADD POINT
	logStream.write(levelKey);
	logStream.end();
	
	//var data = fs.readFileSync('./db/point.txt').toString();
	//var result = data.match(/-2/);
	//alert(result[0]);
	
	//localStorage.setItem('test', 222);
	//alert( localStorage.getItem(keyID) );
	//localStorage.setItem("test", keyID);
	var maneColor = document.getElementById("color_op").value;
	colorN = maneColor.slice(0, -2);
	
	var c=document.getElementById("land_0");
	var ctx=c.getContext("2d");
	ctx.beginPath();
	ctx.fillStyle = colorN;
	ctx.rect(zoomX,zoomY,zoomW,zoomH);
	ctx.fill();
	
	
	var keyID = xS+"_"+yS; //Map Sector LRUD
	var levP = localStorage.getItem(keyID);
	if(levP==null)
	{		
		var id = 1;
		localStorage.setItem(keyID, "POINT:"+zoomX+":"+zoomY+":"+zoomW+":"+zoomH+":"+colorN+":"+id);
		var keyG = "KEY_"+keyID;
		localStorage.removeItem(keyG);
		localStorage.setItem(keyG, 1);
	}
	else
	{		
		var keyG = "KEY_"+keyID;
		var levID = localStorage.getItem(keyG);
		var x = parseInt(levID);	
		var idx = x+1;
		localStorage.setItem(keyG, idx);
		
		var keyG = "KEY_"+keyID;
		localStorage.removeItem(levID);
		
		
		for (var i = 0; i < levID; i++) {
			var keyID = xS+"_"+yS+"_"+i;
			var levP2 = localStorage.getItem(keyID);			
			if(levP2!=null){
				//alert(levP2);
				var FD = levP2.split(':');
				var fID = FD[6]; //ID
			}else{}

		}
		
		var keyIDA = xS+"_"+yS+"_"+idx; //Map Sector LRUD
		localStorage.setItem(keyIDA, "POINT:"+zoomX+":"+zoomY+":"+zoomW+":"+zoomH+":"+colorN+":"+idx);
		
	}
}



//SAVE DATA FILE
var imgTmp=0;
var dataSend=0;
var dataNameT=0;
function saveData(b64Data,name)
{
	//alert("SAVE FILE:"+name);	

	var sendDataBTN = document.getElementById("sendDataBTN");
	var newFileName="./files/"+name;		
	//var newFileName="./uploaded/"+name;	
	var fs = require("fs");			
	//import fs from 'fs';
	fs.writeFile(newFileName, b64Data, {encoding: 'base64'}, function(err) {
		console.log('File created');
		alert("File created: "+name);
		dataNameT=0; dataSend=0;		
	});	
	if(dataNameT!=0){sendDataBTN.style.display="block";}else{sendDataBTN.style.display="none";}
}



//READ FILE
//var imgTmp=0;
//var dataSend=0;
//var dataNameT=0;
function doFILE(n)
{
	var fs = require("fs");	 

	var fileNM = "./media/"+n;
	imgTmp = fileNM;
	
	fs.readFile(fileNM, function(error,data)
	{ 
		if(error) {
			return console.log(error);			
		}
		
		//File to send
		dataSend = data;
		
		//SAVE FILE
		var newFileUrl='./files/'+n;
		fs.writeFileSync(newFileUrl, data);
	});
	console.log("Asynchronous reading of files");
		
	dataNameT = n; 
	
	var medFile = document.getElementById("videoBLOB");
	var dataImg = document.getElementById("dataImage");	
	var sendDataBTN = document.getElementById("sendDataBTN");	
	
	//Send BTN Status
	if(dataNameT!=0 && onlineStatus == 1){sendDataBTN.style.display="block";}else{sendDataBTN.style.display="none";}
	
	
	var FD = n.split('.');					
	var fN = FD[0]; //Name
	var fT = FD[1]; //type
	if(fT=="mp3" || fT=="mp4" || fT=="avi" || fT=="wmv" || fT=="wav")
	{	
		medFile.style.display="block";
		dataImg.style.display="none";
		linkBlob(n);
	}
	if(fT=="jpg" || fT=="png" || fT=="gif" || fT=="jpeg")
	{
		medFile.style.display="none";
		dataImg.style.display="block";
		dataImg.src="./media/"+n;
	}
	if(fT=="html" || fT=="txt" || fT=="exe" || fT=="zip" || fT=="rar" || fT=="7z")
	{
		medFile.style.display="none";
		dataImg.style.display="block";
		dataImg.src="./src/file.jpg";
	}
}



//READ DATA FILE
function readDATAFile()
{	runingFun("readDATAFile");	
	var fs = require("fs");
	var fileContent = fs.readFileSync('src/data.txt', 'utf8');
	objPOS = fileContent;
	doRandOBJ(fileContent,ex,ey);
}



//IMAGE FILES FOLDER APP
var cnvFL=0;
function filesLIST(f,c)
{	
	var a2 = document.getElementsByTagName('div');
	var body=document.getElementsByTagName('body')[0];
	var newDiv2 = document.createElement('div');
	if(c=="IMG") {var firstDiv2=document.getElementById('IMAGES_LIST');}
	if(c=="FILE"){var firstDiv2=document.getElementById('FILES_LIST'); }
	if(c=="SITE"){var firstDiv2=document.getElementById('SITES_LIST'); }	
	var firstElem2=firstDiv2.getElementsByTagName('div')[0];	
	var divNum2 = a2.length;
	cnvFL=cnvFL+1;	
	newDiv2.className = 'range_box_layer';	
	newDiv2.id = divNum2;
	newDiv2.style.backgroundColor = '#CBEBFF';	
	if(c=="IMG") {newDiv2.innerHTML = '<span class="btnLnk" onclick=javascript:imageInCanvas("container","'+f+'",0,0,0,0);return false>'+f+'</span>';}
	if(c=="FILE"){newDiv2.innerHTML = '<span class="btnLnk" onclick=javascript:doFILE("'+f+'");return false>'+f+'</span>';}
	if(c=="SITE"){newDiv2.innerHTML = '<span class="btnLnk" onclick=javascript:goSite("'+f+'");return false>'+f+'</a>';}	
	firstDiv2.insertBefore(newDiv2,firstElem2);		
}


	
//APP FILES DIR	
function dirFilesFolder2()
{
	var fs = require('fs');
	var path = require('path');

	var getFiles = function (dir, files_){
		
		files_ = files_ || [];
		var files = fs.readdirSync(dir).sort();
		for (var i in files)
		{
			var name = dir + files[i];
			var NA = name.split('/');					
			var fC1 = NA[1]; //cat
			//var fN = NA[2]; //name
			//var fR = NA[3]; //type		
			//if(fC=='media'){ filesLIST(fN,"FILE");}
			//if(fC=='sites'){ filesLIST(fN,"SITE");}
			if(fC1=='images'){filesLIST(name,"IMG");}

			if (fs.statSync(name).isDirectory()){
				getFiles(name, files_);
			} else {
				files_.push(name);
			}
		}

		return files_;

	};
		
	//var dirFiles=(getFiles('./media/'));
	//var dirFiles=(getFiles('./sites/'));
	var dirFiles=(getFiles('./images/'));		
}

setTimeout(() => {
 dirFilesFolder2();	
}, "1000");


	

	
//APP FILES DIR	
function dirFilesFolder()
{
	var fs = require('fs');
	var path = require('path');

	var getFiles = function (dir, files_){
		
		files_ = files_ || [];
		var files = fs.readdirSync(dir).sort();
		for (var i in files)
		{
			var name = dir + files[i];
			var NA = name.split('/');					
			var fC = NA[1]; //cat
			var fN = NA[2]; //name
			var fR = NA[3]; //type		
			if(fC=='media'){ filesLIST(fN,"FILE");}
			if(fC=='sites'){ filesLIST(fN,"SITE");}
			//if(fC=='images'){filesLIST(name,"IMG");}

			if (fs.statSync(name).isDirectory()){
				getFiles(name, files_);
			} else {
				files_.push(name);
			}
		}

		return files_; 

	};
		
	var dirFiles=(getFiles('./media/'));
	var dirFiles=(getFiles('./sites/'));
	//var dirFiles=(getFiles('./images/'));	
}	
	
	



var imgName1;	
function creatCanvasEL(f,x,y,w,h,d)
{
		var canvas = document.createElement('canvas');

		canvas.id = "CursorLayer";
		canvas.width = zoomW;
		canvas.height = zoomH;
		canvas.style.zIndex = 0;
		canvas.style.position = "absolute";
		canvas.style.display = "none";
		canvas.style.border = "0px solid";

		var body = document.getElementsByTagName("body")[0];
		body.appendChild(canvas);

		cursorLayer = document.getElementById("CursorLayer");

		/*
		console.log(cursorLayer);
		// below is optional
		var ctx = canvas.getContext("2d");
		ctx.fillStyle = "rgba(255, 0, 0, 0.2)";
		ctx.fillRect(100, 100, 200, 200);
		ctx.fillStyle = "rgba(0, 255, 0, 0.2)";
		ctx.fillRect(150, 150, 200, 200);
		ctx.fillStyle = "rgba(0, 0, 255, 0.2)";
		ctx.fillRect(200, 50, 200, 200);
		*/

		var canvas = document.getElementById('CursorLayer'),
		context = canvas.getContext('2d');

		canImageurl='./images/'+f+'.jpg';
		
		make_base();

		function make_base()
		{
			base_image = new Image();
			base_image.src = canImageurl;
			base_image.onload = function(){
			//context.drawImage(base_image, 0, 0);
			context.drawImage(base_image, zoomX, zoomY, zoomW, zoomH,    0, 0, zoomW, zoomH );
			//context.drawImage(base_image, x, y, w, h,    0, 0, w, h );
			}
		}
			
		gCAN(5); //Test..
		
		setTimeout(() => {
			var fs = require("fs");
			var imgc = canvas.toDataURL("image/jpeg", 1.0);	
			var data = imgc.replace(/^data:image\/\w+;base64,/, "");
			var buf = new Buffer(data, 'base64');
			canImageurl1='./images/point/'+f+'.jpg';
			fs.writeFileSync(canImageurl1, buf);
			
			var keyID = xS+"_"+yS; //Map Sector LRUD
			localStorage.setItem(keyID, "SNAPSHOT:"+zoomX+":"+zoomY+":"+zoomW+":"+zoomH+":"+canImageurl1);	
			canvas = null; 		
		}, "1000");
		
}
	

	
//CAN LAYER COPY
function gCAN(id)
{
	var can0 = document.getElementById('land_1');
	var ctx0 = can0.getContext('2d');
		
	var can1 = document.getElementById('container');
	var ctx1 = can1.getContext('2d');

	var can2 = document.getElementById('land_0'); //container2
	var ctx2 = can2.getContext('2d');

	var can3 = document.getElementById('canvas3');
	var ctx3 = can3.getContext('2d');
	
	ctx3.drawImage(can0, 0, 0);	
	ctx3.drawImage(can1, 0, 0);
	ctx3.drawImage(can2, 0, 0); //OFF
	ctx3.drawImage(can3, 0, 0);	
	
	/*
	if(nowPLay==0)
	{
		//ctx3.drawImage(can1, 0, 0);
	}
	else
	{		
		ctx3.drawImage(can2, 0, 0);
		//ctx3.drawImage(can1, 0, 0);
		//ctx3.drawImage(can0, 0, 0);
		ctx3.drawImage(can3, 0, 0);		
	}
	*/
}	
	
	
	

	
//SAVE CANVAS TO IMAGE AJAX POST PHP
var scanBUF=0;

var imgName=0;
var imgNameNEW;
var contIMG=0;

function saveIt(f,x,y,w,h)
{	runingFun("saveIt");

	var fs = require("fs");

	//IMAGE
	gCAN(5);
	
	var canvas1 = document.getElementById("canvas3"); //canvas3
	var imgc = canvas1.toDataURL("image/jpeg", 1.0);  //jpeg
	
	var can1 = document.getElementById('container');//test
	var ctx1 = can1.getContext('2d');
	
		
	//url prefix to get just the base64-encoded bytes
	var data = imgc.replace(/^data:image\/\w+;base64,/, "");
	var buf = new Buffer(data, 'base64');
	//var bufferx = "canvasData="+buf;
	var bufferx = data;
	
	const dir = './images/';
	fs.readdir(dir, (err, files) => {
		imgName = files.length+1;
	});
		
	//P2P SEND BASE64
	if(f==4)
	{
		scanBUF = data;
	}
	
	//SAVE LOCAL IMAGE FILE
	if(f==3)
	{
		canImageurl='./images/'+imgName+'.jpg';
		fs.writeFileSync(canImageurl, buf);
		imageInCanvas("canvas3",canImageurl,0, 0, 0, 0);
		filesLIST(canImageurl,"IMG");		
		var canImgPREV = document.getElementById("prevIMG");
		canImgPREV.style.display='block';
		var canImage = document.getElementById("canvasImage2");
		canImage.src='./images/'+imgName+'.jpg';
		
		var button = document.getElementById('btn-download_local');
		button.addEventListener('click', function (e) {
		button.href = './images/'+imgName+'.jpg'; //OFF
		});	

		creatCanvasEL(imgName, zoomX, zoomY, zoomW, zoomH, buf);
	}
	
	//SAVE POINT TEST
	if(f==5)
	{	
		canImageurl='./images/point/'+imgName+'.jpg';
		creatCanvasEL(canImageurl, zoomX, zoomY, zoomW, zoomH, buf);
	}
	
	//SCREEN SAVE
	if(f==6)
	{	
		var keyID = xS+"_"+yS; //Map Sector LRUD
		var imgID = keyID; 
		canImageurl='./map/'+imgID+'.jpg';
		if(subP=="1/2"){canImageurl='./map/'+imgID+'L.jpg';}
		fs.writeFileSync(canImageurl, buf);
		var imgF1 = "png"; var imgF2 = "jpg";
		localStorage.setItem(keyID, "MAP:"+xS+":"+xSL+":"+ySL+":"+imgF2+":0");
	}

	//RELOAD IMAGE FILE
	if(f==2)
	{
		if(contIMG==0)
		{
			canImageurl='./src/1.jpg';
			fs.writeFileSync(canImageurl, buf);
		}
	}
		
	//SAVE FILE AND POST FORM
	if(f==1)
	{	
		const dir = './images/';
		fs.readdir(dir, (err, files) => {
		imgNameNEW = files.length+1;			
		//SAVE NEW IMAGE
		//if(saveScr==1){const dir = './map/'; canImageurl='./map/'+imgNameNEW+'.jpg';}else{canImageurl='./images/'+imgNameNEW+'.jpg';}
		canImageurl='./images/'+imgNameNEW+'.jpg';
		fs.writeFileSync(canImageurl, buf);
		imageInCanvas("container",canImageurl,0, 0, 0, 0);
		filesLIST(canImageurl,"IMG");		  
		});
		
		//Prev image to node local no ajax
		var canImage = document.getElementById("canvasImage");
		canImage.style.display='block';
		canImage.style.width='300px';
		canImage.src='./images/'+imgNameNEW+'.jpg';	
		

		//IMG URL
		var imgSite = 'images/'+imgNameNEW+'.jpg';
		
		//NEW POST TITLE | CONTENT
		var postTitle = document.getElementById("post_title").innerHTML; 
		var postContent = document.getElementById("post_content").innerHTML; 
		
	
		//AJAX POST IMAGE BASE64
		var myDrawing = document.getElementById("container"); 		
		var drawingString = myDrawing.toDataURL("image/jpeg", 1.0);
		var postData = imgNameNEW+"|canvasData="+drawingString;
		
		var ajax = new XMLHttpRequest();
		
		ajax.open("POST",'new_post.php?title='+postTitle+'&content='+postContent+'&img='+imgSite,true);
		ajax.setRequestHeader('Content-Type', 'plain/text');
		ajax.onreadystatechange=function() 
		{
			if(ajax.readyState == 4)
			{
				 //Save img file
				var canImage = document.getElementById("canvasImage");
				canImage.style.display='block';
				canImage.style.width='300px';
				canImage.src='./images/'+imgNameNEW+'.jpg';								
			}
		}
		ajax.send(postData);
		
			
		var button = document.getElementById('btn-download');
		button.addEventListener('click', function (e) {
		button.href = './images/'+imgName+'.jpg'; //OFF
		});

	}
	
}


//Grid option
var gridSET = 0;

//Mouse wheel zoom
var objectZOOM;
var cirD=0;

//DRUG
function drug(element){ runingFun("drug");
	element.addEventListener('mousedown', (e) => {
	  dragging = true

	  const style = window.getComputedStyle(element)
	  const transform = new DOMMatrixReadOnly(style.transform)
	  const translateX = transform.m41
	  const translateY = transform.m42

	  startX = e.pageX - translateX
	  startY = e.pageY - translateY
	})

	document.body.addEventListener("mouseup", () => {
	  dragging = false;
	});

	document.body.addEventListener('mousemove', (e) => {
	  if (!dragging) return

	  const x = e.pageX - startX
	  const y = e.pageY - startY

	  element.style.transform = `translate(${x}px, ${y}px)`
	})
}


function fixedGRID(c){ runingFun("fixedGRID");
	var sc = (String(c).length);
	var ssx=0;
	
	if(sc==4)
	{
		var xx = c.toString(); //get x numbers 0-999
		var xt=(xx[0]);        //first num
		var xtt=(xx[1]);       //second num
		var xttt=(xx[2]);      //third num
		if(xttt>5){ ssx=50; }else{ ssx='00';}
		return xt+xtt+ssx;
	}
	if(sc==3)
	{
		var xx = c.toString(); //get x numbers 0-999
		var xt=(xx[0]);        //first num
		var xtt=(xx[1]);       //second num
		if(xtt>5){ ssx=50; }else{ ssx='00';}
		return xt+ssx;
	}
	if(sc==2)
	{
		var xx = c.toString(); //get x numbers 0-99
		var xt=(xx[0]);        //first num
		var xtt=(xx[1]);       //second num
		if(xt>5){ ssx=50; } else{ ssx=0;}
		return ssx;
	}	
	if(sc==1)
	{
		var ssx=0; 
		return ssx;
	}
}

	
//CAN LEAYER LIST
var cnvL=0;
function canLIST(x, y, w, h, f, cnv)
{	
	runingFun("canLIST"); 
	/*
	var a1 = document.getElementsByTagName('div');
	var body=document.getElementsByTagName('body')[0];
	var newDiv1 = document.createElement('div');

	var firstDiv1=document.getElementById('LAYER_LIST');
	var firstElem1=firstDiv1.getElementsByTagName('div')[0];
	
	var divNum1 = a1.length;
	cnvL=cnvL+1;
	
	if(gridSET == 1)
	{		
		var x = fixedGRID(x);
		var y = fixedGRID(y);
	}
	if(f == "slide")
	{		
		secZ = slideSec;
	}
		
	newDiv1.className = 'range_box_layer';	
	newDiv1.id = divNum1;
	newDiv1.style.backgroundColor = '#CBEBFF';
	newDiv1.innerHTML = '<span onclick=removeLayer('+divNum1+','+cnv+','+x+','+y+','+w+','+h+');return false> T:'+secZ+' x: '+x+' y: '+y+'  w: '+w+' h: '+h+'</span>';
	firstDiv1.insertBefore(newDiv1,firstElem1);	
	//body.appendChild(newDiv);

	var lnum=document.getElementById('lnum');
	lnum.innerHTML = cnvL;
	*/	
}


	
function removeLayer(id,cnv,x,y,w,h){ runingFun("removeLayer"); 
	var cM=document.getElementById("container");
	var ctx=cM.getContext("2d");	
	ctx.clearRect(x, y, w, h);	
	var elemLayer = document.getElementById(id);
    elemLayer.parentNode.removeChild(elemLayer);	
	cnvL=cnvL-1;
	var lnum=document.getElementById('lnum');
	lnum.innerHTML = cnvL;
}	

	
//CANVAS///////
var blc=1;
var newDot=1;
var oldNum=1;
//Time arr key S (sec)
var canDOTARR = new Array(blc); //Time
var canDOTARRN = new Array(blc); //Num of dots
var canDOTARRX = new Array(blc);
var canDOTARRY = new Array(blc);
var canDOTARRW = new Array(blc);
var canDOTARRH = new Array(blc);
var canDOTARRC = new Array(blc); 
 
//XY POS
var objARR = new Array(blc); 
var objARRX = new Array(blc);
var objARRY = new Array(blc);
var objARRW = new Array(blc);
var objARRH = new Array(blc);



var ss=0; //slide op


var sizeSX=20;
var sizeT=0;
function createBLOCK(){

    var textBoxM = document.getElementById("text_box_1").innerHTML;
	//alert(textBoxM);
	var canRC1 = document.getElementById("container");
	var ctxRC1 = canRC1.getContext("2d");
	var maneColor = document.getElementById("color_op").value;
		colorN = maneColor.slice(0, -2);
	
	if(textBoxM!='')
	{
		ctxRC1.beginPath();
		ctxRC1.fillStyle = colorN;
		ctxRC1.rect(zoomX,zoomY,zoomW,zoomH);
		ctxRC1.fill();
		
		ctxRC1.beginPath();
		ctxRC1.font = '18px calibri';
		ctxRC1.fillStyle = 'white';
		
		let arr = textBoxM.split('<div>');
		
		for (let i = 0; i < arr.length; i++)
		{
			if(i==0){sizeT = sizeSX;}
			if(i>=1){sizeT = sizeT+sizeSX;}
			
			var resnotags = arr[i].replace(/<!--[\s\S]*?--!?>/g, "").replace(/<\/?[a-z][^>]*(>|$)/gi, ""); // del html tags
			var textSTR = resnotags.replace(/&nbsp;/g, ' ');
			ctxRC1.fillText(textSTR, zoomX+10,zoomY+sizeT, zoomW,zoomH);
		}
		ctxRC1.troke();
	}
	else
	{
		var c=document.getElementById("container"); 
		var ctx=c.getContext("2d");
		ctx.beginPath();
		ctx.fillStyle=colorN;
		ctx.fillRect(zoomX,zoomY,zoomW,zoomH);
		ctx.fill();
	}	
}


var bonus=0;

function doCan(f, x, y, w, h, clr, cnv)
{	runingFun("doCan");
	
	if(gameStatus==1 && flagON==0)
	{ 
		cirD = 1; 
		//dotSizeW=10; 
		//soundClick("BUM");
			
		if(ex<300){soundClick("BUM_L");}
		if(ex>300 && ex<800){soundClick("BUM");}
		if(ex>800){soundClick("BUM_R");}		
		
		if(xFMC-200>=ex && xFMC-300<=ex){ bonus=bonus+1; }
		if(xFMC-300>=ex && xFMC<=ex){ bonus=bonus+1; }
	}

	
	blc=blc+1;

	//collision ARR
	objARR[x] = blc; 
	objARRX[x] = x;
	objARRY[y] = y;
	objARRW[w] = w;
	objARRH[h] = h;	

	var testD=document.getElementById('DRAWTEST');		
	var c=document.getElementById("canvas3"); //cnv
	var ctx=c.getContext("2d");
	ctx.clearRect(0, 0, 2000, 1000);
	
	if(f=='eraser')
	{	
		ctx.clearRect(x, y, zoomX, zoomY);
	}
	else
	{		
		var maneColor = document.getElementById("color_op").value;
		colorN = maneColor.slice(0, -2);
		//Game color
		//if(gameStatus==1 && flagON==0){colorN="red"; }
		
		if(gridSET == 1)
		{		
			var xx = fixedGRID(x);
			var yy = fixedGRID(y);
		}
		else
		{
			var xx=x;
			var yy=y;
		}	
		
		if(s==0){s=blc;}else{s=s;}
		
		canDOTARR[s] = s; //Time code position		
		canDOTARRX[s] = xx; 
		canDOTARRY[s] = yy;
		canDOTARRW[s] = w;
		canDOTARRH[s] = h;
		
		//reapet slide
		if(f=='reload')
		{
			testD.innerHTML = "TEST:"+1;

			canDOTARRN[s] = cnvL;
		}
		
		//new dot
		if(f=='click')
		{		
			testD.innerHTML = "TEST:"+2;
			if(cirD != 1)
			{
				testD.innerHTML = "TEST:"+3;

				//Cube
				oldNum = canDOTARRN[s];
				newDot += oldNum;
				canDOTARRN[s] = cnvL+1; //Dots
				canDOTARRC[s] = colorN;
				canLIST(x, y, w, h, "click", cnv);	
			}	
			if(cirD == 1)
			{	
				testD.innerHTML = "TEST:"+4;
				//Cirkle
				ctx.beginPath();
				ctx.fillStyle = colorN;
				ctx.arc(x, y, dotSizeW, 0, 2 * Math.PI);
				ctx.fill();
				canLIST(x, y, w, h, "click", cnv);
			}
		}
		//slide time
		if(f=='slide')
		{				
			testD.innerHTML = "TEST:"+5;
			canDOTARRN[s] = cnvL;
			colorN=canDOTARRC[s]; 
		}
			
		//IF GREAD FIXED
		if(gridSET == 1)
		{		
			testD.innerHTML = "TEST:"+6;
			var xx = fixedGRID(x);
			var yy = fixedGRID(y);
			
			if(f=='click')
			{
				testD.innerHTML = "TEST:"+7;
		
				if(cirD != 1)
				{
					testD.innerHTML = "TEST:"+8;
					//Cube
					ctx.fillStyle=colorN;
					ctx.fillRect(xx,yy,dotSizeW,dotSizeW);
					ctx.fill();
				}	
				if(cirD == 1)
				{	
					testD.innerHTML = "TEST:"+9;
					//Cirkle
					ctx.beginPath();
					ctx.fillStyle = colorN;
					ctx.arc(xx, yy, dotSizeW, 0, 2 * Math.PI);
					ctx.fill();	
				}				
			}
			
			if(f=='reload')
			{
				testD.innerHTML = "TEST:"+10;
				
				if(cirD == 0 && penD==1)
				{
					testD.innerHTML = "TEST:"+11;
					//Cube
					colorN=canDOTARRC[s];
					ctx.fillStyle=colorN;
					ctx.fillRect(x,y,w,h);
					ctx.fill();
				}	
				if(cirD == 1 && penD==0)
				{	
					testD.innerHTML = "TEST:"+12;
					//Cirkle
					ctx.beginPath();
					ctx.fillStyle = colorN;
					ctx.arc(x, y, dotSizeW, 0, 2 * Math.PI);
					ctx.fill();	
				}	
			}

		}
		else
		{
			testD.innerHTML = "TEST:"+13;
			if(f=='click')
			{
				dotLine(ex,ey,colorN);
				
				//Line 
				if(startLine==1)
				{
					testD.innerHTML = "TEST:"+14;
					//Cirkle of lines dot
					ctx.beginPath();
					ctx.fillStyle = colorN;
					ctx.arc(x, y, dotSizeW, 0, 2 * Math.PI);
					ctx.fill();	
				}
				else
				{			

					if(cirD != 1 && eraserS!=1)
					{						
						dotLine(ex,ey);
						testD.innerHTML = "TEST:"+15+"F:"+eraserS;
						//Cube
						ctx.beginPath();
						canDOTARRC[s]=colorN;
						colorN = maneColor.slice(0, -2);
						ctx.fillStyle=colorN;
						ctx.fillRect(x,y,dotSizeW,dotSizeW);
						ctx.fill();
					}	
					if(cirD == 1)
					{	
						testD.innerHTML = "TEST:"+16;
						//Cirkle
						ctx.beginPath();
						ctx.fillStyle = colorN;
						ctx.arc(x, y, dotSizeW, 0, 2 * Math.PI);
						ctx.fill();	
					}	
				}
			}
			if(f=='reload')
			{
				testD.innerHTML = "TEST:"+17;
				colorN=canDOTARRC[s];
				if(cirD == 1 && penD==1)
				{
					testD.innerHTML = "TEST:"+18;
					//Cube
					ww = canDOTARRW[s];
					hh = canDOTARRW[s];
					ctx.fillStyle=colorN;
					ctx.fillRect(x,y,ww,hh);
					ctx.fill();
				}	
				if(cirD == 1 && penD!=1)
				{	
					testD.innerHTML = "TEST:"+19;
					//Cirkle
					ctx.beginPath();
					ctx.fillStyle = colorN;
					ctx.arc(x, y, dotSizeW, 0, 2 * Math.PI);
					ctx.fill();	
				}	
			}
			if(f=='wheel')
			{			
				testD.innerHTML = "TEST:"+20;
				if(cirD != 1)
				{
					testD.innerHTML = "TEST:"+21;
					//Cube
					colorN=canDOTARRC[s];
					ctx.fillStyle = colorN;
					ctx.fillRect(x,y,w,h);
				}	
				if(cirD == 1)
				{	
					testD.innerHTML = "TEST:"+22;
					//Cirkle
					ctx.beginPath();
					ctx.fillStyle = colorN;
					ctx.arc(x, y, dotSizeW, 0, 2 * Math.PI);
					ctx.fill();	
				}	
			}
		}
	}

	
		//Save canvas image PNG
				
			if(saveScr==1 && canvasIMAGE!=0 && gameStatus==0){ saveIt(6,0,0,0,0); canvasIMAGE=0;}
			else{		
					//Save PNG
					var fs = require("fs");
					var cP=document.getElementById("land_0"); //cnv
					var ctx4=cP.getContext("2d");

					//ctx4.clearRect(0, 0, 2000, 1000);
					buf2='';
					data2='';
					imgc2='';
					ctx4.drawImage(c, 0, 0);
					ctx4.drawImage(cP, 0, 0);

					var imgc2 = cP.toDataURL("image/png", 1.0);  //jpeg
					var data2 = imgc2.replace(/^data:image\/\w+;base64,/, "");
					var buf2 = new Buffer(data2, 'base64');
					
					var keyID = xS+"_"+yS; //Map Sector LRUD
					var imgID = keyID; 
					canImageurl='./map/'+imgID+'.png';
					if(subP=="OK"){canImageurl='./map/'+imgID+'L.png';}
					fs.writeFileSync(canImageurl, buf2);
					
					var imgF1 = "png"; var imgF2 = "jpg";

					//Point
					localStorage.setItem(keyID, "NEW:"+xS+":"+xSL+":"+ySL+":"+imgF1+":"+ex+":"+ey);
					
				}

}







var startLine=0;
var startX=0;
var startY=0;
var saveX=0;
var saveY=0;
function dotLine(x,y,color){runingFun("dotLine");

	var c=document.getElementById("canvas3"); //container
	var ctx=c.getContext("2d");
	
	if(eraserS==1)
	{	
		testD.innerHTML = "TEST:"+23;
		ctx.clearRect(x, y, 100, 100);
	}
	else
	{
		testD.innerHTML = "TEST:"+24;
		if(startLine==0)
		{
			testD.innerHTML = "TEST:"+25;
			startX = x; 
			startY = y; 
			saveX = canDOTARRX[s];
			saveY = canDOTARRY[s];
			sex=ex;
			sey=ey;
		}
		else
		{
			testD.innerHTML = "TEST:"+26;
			sex=saveX;
			sey=saveY;
			saveX = ex;
			saveY = ey;
			if(sex==0 && sey==0)
			{
				testD.innerHTML = "TEST:"+27;
				startX = ex; 
				startY = ey;
				ctx.beginPath();
				ctx.strokeStyle = color;
				ctx.stroke();
			}
			else
			{
				testD.innerHTML = "TEST:"+28;
				startX = saveX; 
				startY = saveY;
				ctx.beginPath();
				ctx.strokeStyle = color;
				ctx.moveTo(startX, startY);
				ctx.lineTo(sex,sey);
				ctx.stroke();
			}
			var keyID = xS+"_"+yS; //Map Sector LRUD
			localStorage.setItem(keyID, "LINE:"+startX+":"+startY+":"+sex+":"+sey+":"+color);	
		}
	}	
}

var newMes = 0;
var opclP=0; 

var lastClickX = 0;
var	lastClickY = 0;
var nowOBJ;
function getId(el){
	runingFun("getId");
	
	var objD = document.getElementById(el);
	var idO = objD.getAttribute("id");
	var wO = objD.getAttribute("width");
	var hO = objD.getAttribute("height");
	var tO = objD.getAttribute("top");
	var lO = objD.getAttribute("left");	
	nowOBJ=idO;	
	
	var element = document.getElementById("INFO-BAR");
	var xPosition = element.offsetLeft;
	var yPosition = element.offsetTop;
	
	
	if(idO=="container")
	{		
		var cp = document.getElementById("INFO-BAR");
		var mb = document.getElementById("myDiv");
		mb.style.visibility = "hidden";		
		cp.style.width = "300px";
		cp.style.background = "#ebebeb";

		var toolsP = document.getElementById("toolsPanel");
	    toolsP.style.display="block";	
		
	}
	if(idO=="BOTBAR") //SLIDE-BAR
	{		

		var cp = document.getElementById("BOTBAR");
		var frmpnl = document.getElementById("FORUM");
		var ctBG = document.getElementById("ctBG");
		var chatn1 = document.getElementById("chatnew");
		var chatCP=document.getElementById("fullChatPanel");
		var chatCP1=document.getElementById("CHAT_CP");
		
		if(opclP==0)
		{
			opclP=1;
			chatn1.innerHTML = "";
			newMes = 0;		
			cp.style.bottom = "200px";
			frmpnl.style.display="block";
			ctBG.style.display="block";
			chatCP.style.opacity = 1.0;
			chatCP1.style.opacity = 1.0;

			//test full chat
			var messageCP2 = document.getElementById('mesChat');
			var yPosition2 = cp.offsetTop;
			//var xPosition2 = cp.offsetLeft;
			messageCP2.style.height=yPosition2-60+"px";
			//messageCP2.style.width=xPosition-10+"px";
		}
		else
		{
			opclP=0;	
			cp.style.bottom = "0";
			frmpnl.style.display="none";
			ctBG.style.display="none";
			chatCP.style.opacity = 0.5;
			chatCP1.style.opacity = 0.5;
			
			//test full chat
			var messageCP2 = document.getElementById('mesChat');
			var yPosition2 = cp.offsetTop;
			messageCP2.style.height=yPosition2-60+"px";
			//messageCP2.style.width=xPosition-10+"px";
		}
		
	}else{}
	
	
	if(idO=="BOTBAR_1") //SLIDE-BAR
	{		
		var cp1 = document.getElementById("BOTBAR_1");
		var frmpnl1 = document.getElementById("FORUM_1");
		
		if(opclP==0)
		{
			opclP=1;	
			cp1.style.bottom = "200px";
			frmpnl1.style.display="block";
		}
		else
		{
			opclP=0;		
			cp1.style.bottom = "0";
			frmpnl1.style.display="none";
		}
	}	
	
	var blueRect = document.getElementById("blueRect");
	blueRect.style.visibility="hidden";		
	document.getElementById("getID").innerHTML="ID:"+idO+" W:"+wO+"H:"+hO+" T:"+tO+" L:"+lO;
	doCan("click",ex,ey,50,50, colorN, idO);
	lastClickX = ex;
	lastClickY = ey;
}




var cntS = "container";

//CREAT CANVAS
var nm=0;
function creatCanvas(x, y, w, h, f)
{ runingFun("creatCanvas");
	if(nm<=100)
	{
		var a = document.getElementsByTagName('div');
		var body=document.getElementsByTagName('body')[0];
		var newDiv = document.createElement('div');
		var firstDiv=document.getElementById('BODY_CANVAS');
		var firstElem=firstDiv.getElementsByTagName('div')[0];		
		var divNum = a.length;
		nm=nm+1;
		newDiv.innerHTML = '<canvas id='+f+' style="position:absolute;width:100px; height:100px;border:1px solid black;"></canvas>';
		firstDiv.insertBefore(newDiv,firstElem)	
		var c=document.getElementById(f);
		var ctx=c.getContext("2d");
		}
}



function doDot(x,y,cnv){ runingFun("doDot");
	var c=document.getElementById(cnv);
	var ctx=c.getContext("2d");
	ctx.fillRect(x,y,dotSizeW,dotSizeW);
}

function writeMessage(context, message)
{ 
	runingFun("writeMessage");
	//context.font = "18pt Calibri";
	//context.fillText(message, 10, 25);
}


function getxy(c)
{
	runingFun("getxy");

	var objD = document.getElementById(c);
	var idO = objD.getAttribute("id");
	var wO = objD.getAttribute("width");
	var hO = objD.getAttribute("height");
	var tO = objD.getAttribute("top");
	var lO = objD.getAttribute("left");
	nowOBJ=idO;	
    if(penD==1){doCan("click",ex,ey,dotSizeW,dotSizeW, colorN, "container");}
	
	
	/*
	var events = new Events(c); //c  //"container"
	var canvas = events.getCanvas();
	var context = events.getContext();	
	canvas.addEventListener("mouseout", function()
	{
		testD.innerHTML = "TEST:"+29;
		//mX=mousePos.x;
		//mY=mousePos.y;
		
	}, false);

	
	canvas.addEventListener("mousemove", function(){
		var mousePos = events.getMousePos();
		//events.clear();
		if (mousePos !== null) {
			//message = "Mouse position: " + mousePos.x + "," + mousePos.y;
			x = Math.round(ex);
			y = Math.round(ey);
			//mX=mousePos.x;
			//mY=mousePos.y;
		}
	}, false);
	
	events.listen();
	*/

};





window.onload = function(){ 

	//Default Background
	saveIt(2,0,0,0,0);
	imageInCanvas("container",'./src/A.png',0,0, 0, 0); //TEST OFF
	
	//APP NW IP LOCAL
	'use strict';
	const { networkInterfaces } = require('os');
	const nets = networkInterfaces();
	const results = Object.create(null);
	for (const name of Object.keys(nets)) {
	for (const net of nets[name]) {
		const familyV4Value = typeof net.family === 'string' ? 'IPv4' : 4
		if (net.family === familyV4Value && !net.internal) {
			if (!results[name]) {
				results[name] = [];
			}
			results[name].push(net.address); 			
			//OS INFO
			l_ip = results[name];
			l_mac = net.mac;
			document.getElementById("USER_ID").innerHTML="USER: "+l_ip+" | "+l_mac;
		}
	}
	}
	
	//Image files list APP NW
	dirFilesFolder();
	
	
	/*
	var events = new Events(cntS);//myCanvas
	var canvas = events.getCanvas();
	var context = events.getContext();
	
	canvas.addEventListener("mouseout", function(){
		//events.clear();
		//writeMessage(context, "Mouseover me!");
	}, false);
	
	canvas.addEventListener("mousemove", function(){
		var mousePos = events.getMousePos();
		//events.clear();

		if (mousePos !== null) {
			message = "Mouse position: " + mousePos.x + "," + mousePos.y;
			//writeMessage(context, message);
		}
	}, false);
	
	events.listen();

	//writeMessage(context, "Mouseover me!");
	*/
};
	



//Frame upload
function uploadFileX(){
	window.open('src/JS_SAVE_FILE.html', 'frame', 'width=500,height=500');
}

//MANE PAGE
function manePage(id){
    if(id==1){window.open('https://', 'frame', 'width=1400,height=700');}
	if(id==2){window.open('index.html', 'blank', 'width=600,height=500');}
	if(id==3){window.open('client.html', 'blank', 'width=600,height=500');}
	if(id==4){window.open('index.html', 'frame', 'width=600,height=500');}
}

//BLOG POST
function blogPost(url){
	window.open(url, 'frame', 'width=1400,height=700');
}

function resizeBAR(){
    var cp = document.getElementById("INFO-BAR");
	cp.style.width = "480px";
	cp.style.background = "#F5F5F5";
}

var sbCO=0;
function resizeSB(){
	if(sbCO==0){ sbCO=1; var cp = document.getElementById("SLIDE-BAR"); cp.style.top = "575px";}
	else{ sbCO=0; var cp = document.getElementById("SLIDE-BAR"); cp.style.top = "650px"; }	
}


var conST=0;
var liveSCN=0;
function LSCAN()
{
	var livebtn = document.getElementById("scanP");
	if(liveSCN==0 && conST==1)
	{
		liveSCN=1;
		livebtn.style.background="red";		
	}
	else
	{
		liveSCN=0;
		livebtn.style.background="#ebebeb";
	}
	if(liveSCN==0 && conST==0){alert("No Connection to Peer.");}
}


function loaderStatus(s)
{
	if(s==0)
	{
		// Select the image element using its ID
		const image = document.getElementById('laoderS');
		// Update the image source
		image.src = './src/loaderOFF.gif';
		conST=0;
		var livebtn = document.getElementById("scanP").style.background="#ebebeb";
	}
	if(s==1)
	{
		// Select the image element using its ID
		const image = document.getElementById('laoderS');
		// Update the image source
		image.src = './src/loaderON.gif';
		conST=1;
	}
}

function clsBTNB()
{
	var btnBACK1 = document.getElementById('btnBACK');
    if(statusBACK==0)
	{		
		statusBACK=1;		
		btnBACK1.style.display='none';
		topicID=0;
	}
	else
	{
		statusBACK=0;
		btnBACK1.style.display='block';
	}	
}

//COPY INPUT ID
function myFunction() {
  // Get the text field
  var copyText = document.getElementById("userID");
  
  // Select the text field
  copyText.select();
  copyText.setSelectionRange(0, 99999); // For mobile devices
  
   // Copy the text inside the text field
  navigator.clipboard.writeText(copyText.value);
  // Alert the copied text
  alert("Copied ID:  " + copyText.value);
}

function clearDB(){localStorage.clear();}


</script>
</head>


<body id="main" onMouseMove="javascript:getXYP(event);" style="position:absolute;width:100%; height:100%; min-width:320px;  font: normal 1em/1.3 Arial, sans-serif;padding: 0; overflow-y: scroll; margin: 0 auto; background-color: #ebebeb; overflow-x: hidden; overflow-y: hidden;">


	<span onclick='javascript:fullScreen();return false' id="fullscreen2" style="z-index:1100; position:absolute;  float:right; right:0; padding-right:20px; padding-top:16px; width:20px; display:none;">
		<img src="./src/fullscreen.png" style="width:20px; display:block; cursor: pointer;" alt="Fullscreen">
	</span>



	<div id="BROWSER-BAR" class="accordion" style="display:none;width:100%;left:0;float:left;position:absolute; z-index:110;">
		<span style="" style="float:left;">BROWSER</span>
		<span id="btnBACK" onclick='javascript:goSite("BLOG.txt"); clsBTNB()' style="display:none;float:left;">[&nbsp;&#9668;&nbsp;BACK&nbsp;]&nbsp;</span>
		<span onclick='javascript:clsBRW();return false' style="float:right;padding-right:6px;">&#10060;</span>
	</div>


	<div id="SITE" style="background:#D9D9D9;padding-top:40px; display:none;position:absolute;width:100%;height:82%;left:0;z-index:100;overflow-x: hidden; overflow-y: auto;"></div>
	<div id="TOPIC" style="background:#D9D9D9;padding-top:40px; display:none;position:absolute;width:100%;height:82%;left:0;z-index:100;overflow-x: hidden; overflow-y: auto;"></div>


	<div id="blueRect" onclick='javascript: getId(this.id);' onMouseMove="javascript:getxy('blueRect');" style="visibility: hidden; cursor: pointer; position: absolute; z-index: 100;" class="myCan2"></div>
	<div id="div-resize" class="myCan2" style="cursor: pointer; position: relative; z-index: 100;"></div>


	<div id="INFO-BAR">

		<a style="cursor: pointer;">
			<img  onclick="manePage(2);return false" id="laoderS" src="./src/loaderOFF.gif" style="width:20px" alt="">
			<span onclick="manePage(2);return false"style="width:120px; font: bold 27px Verdana, Arial, sans-serif; color: #000">P2P SERVER</span>
			<img  onclick='javascript: fullScreen();return false' id="fullscreen" src="./src/fullscreen.png" style="padding-right:10px; padding-top:6px;float:right; width:20px; opacity: 0.4;" alt="Fullscreen">
		</a>
		
	<!--<h4>MENU</h4>-->	
	
	<button class="accordion" id="toolsD">TOOLS <span style="color:#ebebeb">&#9776;</span></button>
	<div class="panel" id="toolsPanel">	
	
		<div id="keyXY" style="margin-top:8px; margin-bottom:8px">GLOBAL POS</div>	
		<div id="keyXY1" style="margin-top:8px; margin-bottom:8px">G----</div>	
		<div id="keyXY2" style="margin-top:8px; margin-bottom:8px">L----</div>	
		<div id="getXYP" style="margin-top:8px; margin-bottom:8px">MOUSE POS</div>	
		<div id="info_1" name="info_1" style="margin-top:8px; margin-bottom:8px" size=10></div>
		<div id="info_2" name="info_2" style="margin-top:8px; margin-bottom:8px" size=10></div>
		<div id="info_3" name="info_3" style="margin-top:8px; margin-bottom:8px" size=10></div>
		<div id="LEV"    name="info_5" style="margin-top:8px; margin-bottom:8px" size=10></div>	
		
		<div style="padding-bottom:10px;">
			<button id="selZBTN" class="acntM" style="width:25%;float:left;" onclick='javascript: selZM(1);return false'>EDIT</button>
			<button id="cm_8" class="acntM" style="width:20%;float:left;" onclick='javascript: createBLOCK(3,0,0,0,0);'>CREATE</button>
			<button id="cm_8" class="acntM" style="width:20%;float:left;" onclick='javascript: saveSCR();'>SCREEN</button>
			<button id="cm_11" class="acntM" style="width:10%;float:right;" onclick='javascript: clearDB();'>&#9776;&#10060;</button>
			<button id="cm_10" class="acntM" style="width:25%;float:right;" onclick='javascript: addPoint();'>ADD POINT</button>
			<button id="cm_9" class="acntM" style="width:25%;float:right;" onclick='javascript: saveIt(3,0,0,0,0);'>SAVE FILE</button>
			<button id="cm_12" class="acntM" style="width:30%;float:right;" onclick='javascript: saveIt(3,0,0,0,0);'>SAVE POINT</button>
			<button id="cm_13" class="acntM" style="width:30%;float:right;" onclick='javascript: startGame();'>PLAY &#9658;</button>
		</div>
		
		<div style="margin-top:40px;">
			<h1 contenteditable="true" aria-label="Text box" role="textbox" aria-multiline="true" style="font-size:12px;white-space: pre-wrap; min-width: 1px;" id="text_box_1">Write your text here...</h1>
		</div>
		
		<br>
		
		<input type="file" id="imageLoader" name="imageLoader" class="imageLoader"/>
		<button class="button-41" style="margin-top:2px;margin-bottom:2px;" onclick="saveIt(1,0,0,0,0)">SAVE</button>
		<a href="#" class="buttonOFF" id="btn-download" download>
			<img src="" width="300" style="display:none;" id="canvasImage">
		</a>
		

		<div style="display:none;" id="prevIMG">
			<a href="#" class="button11" id="btn-download_local" download>
				<img src="" id="canvasImage2" style="width:260px">
			</a>
		</div>
		

	</div>
	
	
	<br>

	
	<button class="accordion" id="mediaPL" style="display:none;">MEDIA</button>
	<div class="panel" style="padding:0;margin:0;display:block;">
		<video id="videoBLOB" controls="true" volume="60%" width="300" height="176" style="display:none;background-color:transparent;padding:0;margin:0;"></video>
		
		<a onclick=imageInCanvas("container",imgTmp,0,0,0,0); href="#">
			<img src="" style="display:none;" width="300" id="dataImage">
		</a>
		
		<button id="sendDataBTN" class="button-41" style="display:none; margin-top:2px;margin-bottom:2px;">SEND FILE</button>
		
	</div>
	


	<button class="accordion">SERVER</button>
	<div class="panel">
	    <h3>Peer-to-Peer Cue System</h3>
        <table class="control">
            <tbody>
			
			
			<h1 contenteditable="true" aria-label="Title 1" role="textbox" aria-multiline="true" style="font:normal 1.1em verdana,arial,tahoma, sans-serif;white-space:pre-wrap;min-width:1px;" id="server-id">Nickname</h1>
			
			
			<tr>
                <td class="title">Status:</td>
            </tr>
			
            <tr>
                <td>
                    <span style="font-weight: bold"></span>
                    <input type="text" id="receiver-id" title="Input the ID from receive">
                    <button id="connect-button">Connect</button>
                </td>				
				<br>
            </tr>
			
			
            <tr>
                <td><div id="status" class="status" style="border: none; height:14px;"></div></td>
            </tr>
			

			
			<div>
				<a onclick="manePage(2);return false" style="cursor: pointer;">[ SERVER ]</a>  <a onclick="manePage(3);return false" style="cursor: pointer;">[ CLIENT ]</a>		
				<br><br>
				<a id="scanP" onclick="LSCAN()" style="cursor: pointer;">[ LIVE ]</a> 
				<a id="scanPAGE"  onclick="saveIt(4,0,0,0,0);return false" style="cursor: pointer;">[ SCAN PAGE ]</a>
				
				<a onclick="manePage(4);return false" style="cursor: pointer;">[ TEST ]</a>
				<br><br>
			</div>

			
			
			<td>
				<input type="text" value="" id="userID">
				<!-- The button used to copy the text -->
				<button onclick="myFunction()">Copy</button>
			
				<!--<div id="status" class="status">Awaiting connection...</div>-->
				<div id="receiver-id2" style="font-weight: bold;" title="Copy this ID to the input on send"></div>
            </td>

        </tbody></table>
	</div>
	

	
	<button class="accordion"  style="display:none;">POST</button>
	<div class="panel">		
		<h1 onclick='resizeBAR();return false;' contenteditable="true" aria-label="Title 1" role="textbox" aria-multiline="true" style="white-space: pre-wrap; min-width: 1px;" id="post_title">Title text</h1>
		
		<h1 onclick='resizeBAR();return false;' contenteditable="true" aria-label="Title 1" role="textbox" aria-multiline="true" style="font:normal 1.4em verdana, arial, tahoma, sans-serif; white-space: pre-wrap; min-width: 1px;" id="post_content">Write your text here</h1>
			
	</div>
	
	
	
	<button class="accordion" onclick='userLIST();return false;'>USERS DB <span style="color:#ebebeb">&#8801;</span></button>
	<div class="panel">
	  
		<div id="USER_LAYER_LIST" style="border:0px solid #ccc; padding:0px; margin-left:-10px;  display:block;background:silver;width:300px;height:260px;position:relative;left:0px;overflow-y: auto;"><span id="unum"></span>
		<div id="USER_LIST" style="width:100%;height:100%; position: absolute; left: 0px; top: 0px; z-index: 1; overflow-y: auto;"></div>	
		</div>
	  	  
	</div>
	
	

	<button class="accordion" onclick='opnBRW();return false;'>LOCAL BROWSER</button>
	<div class="panel">	  
		
		<div id="IMG_LAYER_LIST" style="border:0px solid #ccc; padding:0px; margin-left:-10px;  display:block;background:silver;width:300px;height:260px;position:relative;left:0px;overflow-y: auto;"><span id="pnum"></span>
		<div id="SITES_LIST" style="width:100%;height:100%; position: absolute; left: 0px; top: 0px; z-index: 1; overflow-y: auto;"></div>
		<div id="chat" style="display:none;width:100%;height:1%; position: absolute; left: 0px; top: 0px; z-index: 1; overflow-y: auto;"></div>	
		</div>
	  	  
	</div>
	
		
	<button class="accordion">FILES <span style="color:#ebebeb">&#8801;</span></button>
	<div class="panel">
	  
		<div id="IMG_LAYER_LIST" style="border:0px solid #ccc; padding:0px; margin-left:-10px;  display:block;background:silver;width:300px;height:260px;position:relative;left:0px;overflow-y: auto;"><span id="pnum"></span>
		<div id="FILES_LIST" style="width:100%;height:100%; position: absolute; left: 0px; top: 0px; z-index: 1; overflow-y: auto;"></div>
		<div id="chat" style="display:none;width:100%;height:1%; position: absolute; left: 0px; top: 0px; z-index: 1; overflow-y: auto;"></div>	
		</div>
	  	  
	</div>

	
	<button class="accordion">IMAGES <span style="color:#ebebeb">&#10070;</span></button>
	<div class="panel">
	  
		<div id="IMAGES_LIST_X" style="border:0px solid #ccc; padding:0px; margin-left:-10px;  display:block;background:silver;width:300px;height:260px;position:relative;left:0px;overflow-y: auto;"><span id="fnum"></span>	
		<div id="IMAGES_LIST" style="width:100%;height:100%; position: absolute; left: 0px; top: 0px; z-index: 1; overflow-y: auto;"></div>
		</div>	
	  	  
	</div>
		
	
	<button class="accordion">PARAMETERS</button>
	<div class="panel">
	
		<div style="display:block:position:absolute;float:left;">
		
			<div class="range_box"  style="padding: 10px; width:260px; margin:4px;">
				<select class="custom-select" onchange="GetSelectedTextValue(this)">
						<option value="1">RECTANGLE</option>
						<option value="7">TRIANGEL</option>
						<option value="2">CIRCLE</option>
						<option value="6">FLATNESS</option>
						<option value="3">LINE 1</option>
						<option value="4">LINE 2</option>
						<option value="5">TEXT BOX</option>
				</select>	
			
				<span style="width:160px;padding-left:10px;display:block:position:absolute;float:right;">
					FILL: <input type="checkbox" id="cb1" onclick="cB('cb1','FILL ON')">
					<p id="text" style="display:none">Fill ON</p>
					MOUSE: <input type="checkbox" id="cb2" onclick="cB('cb2','POS')">
					<p id="text" style="display:none">Pos XY</p>
				</span>

			</div>
			
			<span style="width:100%;margin:0;top:0;padding:4px;background:#ffffff;display:block:position:absolute;float:left;">
				<textarea id="text_box" style="display:none;" onclick='resizeBAR();return false;' onkeydown='textDraw();' name="review" rows="1" cols="34">Test text</textarea>
			</span>
			
		</div>

		
		<div class="range_box"  style="padding: 10px; width:260px; margin:4px;">
			W:<input id="w" onmousemove="getV(this.id,this.value)" type="range" class="range" value="0" min="1" max="1000">
			<span id="w_v" class="rangeValue" style="width:50%">0</span>
		</div>

		<div class="range_box"  style="padding: 10px; width:260px; margin:4px;">
			H:<input id="h" onmousemove="getV(this.id,this.value)" type="range" class="range" value="0" min="1" max="1000">
			<span id="h_v" class="rangeValue" style="width:50%">0</span>
		</div>

		<div class="range_box"  style="padding: 10px; width:260px; margin:4px;">
			X:<input id="x" onmousemove="getV(this.id,this.value)" type="range" class="range" value="0" min="1" max="1000">
			<span id="x_v" class="rangeValue" style="width:50%">0</span>
		</div>

		<div class="range_box"  style="padding: 10px; width:260px; margin:4px;">
			Y:<input id="y" onmousemove="getV(this.id,this.value)" type="range" class="range" value="0" min="1" max="1000">
			<span id="y_v" class="rangeValue" style="width:50%">0</span>
		</div>
	  	  
	</div>
	
	
	

	<button class="accordion">FUNCTION</button>
	<div class="panel">
	
	
		<button class="accordion">HISTORY</button>
		<div class="panel">	 
			<div id="LAYER_LIST" style="border:0px solid #ccc; padding:0px; margin-left:-10px;  display:block;background:silver;width:300px;height:260px;position:relative;left:0px;overflow-y: auto;">LIST:<span id="lnum">0</span>	
			</div>
		</div>
			
		
		<span><p>INFO BAR</p></span>
		<div id="position">OBJECT POSITION</div>
		<div id="COR">CORRECTION ZOOM</div>
		<div id="XYZ">XYZ</div>		
		<div id="DRAWTEST">DRAW TEST</div>		
		<div id="MEMORY_TEST">MEMORY TEST</div>	
		<div id="USER_ID">USER</div>
		SLIDE ZOOM: <span id="delta">0</span>	
		<div id="getID">ID</div>

		<div id="FLATNESS">FLATNESS: X1 Y1 X2 Y2</div>
		
		<br>
		<span>CONNECTION STATUS</span>
		<br>
		
		<button type="button" class="acntM" style="width:20%;float:left;" id="resetButton">Reset</button>             
		<button type="button" class="acntM" style="width:20%;float:left;" id="goButton">Go</button>        
		<button type="button" class="acntM" style="width:20%;float:left;" id="fadeButton">Fade</button>             
		<button type="button" class="acntM" style="width:20%;float:left;" id="offButton">Off</button>
		
		
		<div id="RUNF" style="display:block;border:1px solid #ccc;background-color:#ebebeb;padding:4px;margin:0px;width:312px;height:18px;position:absolute;top:580px;left:-1px;">	
		RUNNING FUNCTION
		</div>	
		
		<div id="FNC_LIST" style="display:block;padding:6px;background:silver;width:308px;height:78px;position:absolute;top:600px;left:-1px;overflow-y:auto;border:1px solid #ccc;">FUNCTION LIST
		</div>	
	 
	</div>
	
	

		<div style="position:fixed;bottom:0; width:1400px; padding-top:4px;padding-bottom:4px; padding-right:4px; padding-left:8px; right:0; display:block; background:#ebebeb;">
			<div class="controls" style="right:0;float:right;"> <div style="display:inline;padding-right:10px" id="TEST_INFO">----</div> <button id="reload" type="button">&#x21bb;</button> </div>
			<div class="event-log"><label for="eventLog"></label><div class="event-log-contents" id="eventLog"></div></div>	
		</div>
		
	</div>	


	<div id="MB" style="position:absolute; z-index:10; left:-48px;" width="180" height="200">
		<div id="myDiv" style="z-index:20;visibility:hidden;position:absolute;width:400px; padding:4px; border:1px solid #ccc;background-color: #ebebeb;">
			<a id="cm_3" class="acntM" onclick='javascript: penDraw(1)'>PEN DRAW</a>
			<a id="cm_5" class="acntM" onclick='javascript: cirDraw(1)'>CIRCLE</a>
			<a id="cm_6" class="acntM" onclick='javascript: lineDraw(1)'>LINE</a>
			<a id="cm_10" class="acntM" onclick='javascript: selOpnBOX()'>TEXT BOX</a>
			<a id="cm_1" class="acntM" onclick='javascript: gridCntMenu()'>GRID EDIT</a>
			<a id="cm_4" class="acntM" onclick='javascript: offGrid(1)'>OFF GRID</a>
			<a id="cm_7" class="acntM" onclick='javascript: eraserDraw(1)'>ERASER</a>
			<a id="cm_11" class="acntM" onclick='javascript: zoomCAN(1)'>ZOOM</a>
			<a id="cm_8" class="acntM" onclick='javascript: saveIt(3,0,0,0,0);'>SAVE FILE</a>
			<a id="cm_2" class="acntM" onclick='javascript: clsCntMenu()'>CLOSE &times;</a>
			<button id="cm_14" class="acntM" style="width:30%;height:40px; float:right; position:absolute; left:220px; top:80px;" onclick='javascript: startGame();'>PLAY/STOP</button>
			

			
			<div style="position:absolute;top:14px;left:140px;height:20px; padding:1px;">
				<div class="dropdown">
					<button class="dropbtn">MODEL</button>
					<div class="dropdown-content">
						<a onclick=imageInCanvas("land_1",'./map/3D/MOD/0.png',0,0,0,0); href="#">PLANE</a>
						<a onclick=imageInCanvas("land_1",'./map/3D/MOD/1.png',0,0,0,0); href="#">CAR 1</a>
						<a onclick=imageInCanvas("land_1",'./map/3D/MOD/2.png',0,0,0,0); href="#">HELICOPTER</a>
						<a onclick=imageInCanvas("land_1",'./map/3D/MOD/3.png',0,0,0,0); href="#">SPHERE</a>
						<a onclick=imageInCanvas("land_1",'./map/3D/MOD/4.png',0,0,0,0); href="#">CUBE</a>
						<a onclick=imageInCanvas("land_1",'./map/3D/MOD/5.png',0,0,0,0); href="#">CUBE 2</a>
						<a onclick=imageInCanvas("land_1",'./map/3D/MOD/6.png',0,0,0,0); href="#">HAND</a>
						<a onclick=imageInCanvas("land_1",'./map/3D/MOD/7.png',0,0,0,0); href="#">GRID</a>
						<a onclick=imageInCanvas("land_1",'./map/3D/MOD/8.png',0,0,0,0); href="#">MODEL 4</a>
					</div>
				</div>
			</div>
			
			
			<div style="position:absolute;top:14px;left:220px;height:20px; padding:1px;">
				<div class="dropdown">
					<button class="dropbtn">BACKGROUND</button>
					<div class="dropdown-content">
						<a onclick=imageInCanvas("container",'./images/A.png',0,0,0,0); href="#">ALPHA</a>
						<a onclick=imageInCanvas("container",'./images/2.png',0,0,0,0); href="#">GRID</a>
						<a onclick=imageInCanvas("container",'./images/3.jpg',0,0,0,0); href="#">BLACK</a>
						<a onclick=imageInCanvas("container",'./images/1.jpg',0,0,0,0); href="#">WHITE</a>
						<a onclick=imageInCanvas("container",'./images/4.jpg',0,0,0,0); href="#">IMAGE</a>
					</div>
				</div>
			</div>
			
			
			<span style="position:absolute;top:8px;left:380px; padding:4px; float:right;right:0;">
				<a id="cm_2" class="acntM" onclick='javascript: clsCntMenu()' style="color:#000000;"> &#10060 </a>
			</span>
			

			
			<div style="margin-top:10px;">									
				<div class="range_box"  style="padding: 10px; width:250px; margin-top:4px; margin-bottom:10px">
					<input type="range" class="range" value="10" min="1" max="100">
					<span class="lineSizeV" style="width:50%">10</span>
				</div>				
				<div class="range_box"  style="padding: 10px; width:250px; margin-top:4px; margin-bottom:10px">
					<input type="range" class="range" value="1000" min="1" max="2000">
					<span class="canSizeV" style="width:50%">1000</span>
				</div>
				
				<select class="custom-select" onchange="GetSelectedTextValue(this)">
						<option value="1">SIZE | SPEED</option>
						<option value="2">STEP</option>
				</select>	
				
				<div style="margin-top:4px; margin-bottom:10px"><input onmouseover=loadJavaScriptSync("src/jscolor.js"); id="color_op" value="#00000096" data-jscolor="{}"></div>
			</div>
			
		</div>		
	</div>



	<div id="FON" style="z-index:0;position:absolute;width:1040px; height:700px; border:0px solid #ccc;background-color: #fff;">

		<canvas id="container" onclick='javascript: getId(this.id);' onMouseMove="javascript:getxy('container');" oncontextmenu="opnCntMenu()" class="myCan" style="top:0;left:0;position:fixed; z-index:2; border:0;">
		</canvas>

		<canvas id="container2" style="visibility:hidden;     top:0;left:0;position:fixed; z-index:1; border:0" class="myCan"></canvas>
	
		<canvas id="canvas3"  style="visibility:hidden; top:0;left:0;position:fixed; position:absolute; z-index:1; border:0;" class="myCan"></canvas>
		
		<canvas id="land_1" class="myCan" onclick='javascript: getId("container");'  style="top:0;left:0;position:fixed; z-index:4; cursor:none; border:0;" onMouseMove="javascript:getxy('land_0');" oncontextmenu="opnCntMenu()"></canvas>
		
		<canvas id="land_0" class="myCan" onclick='javascript: getId("container");' style="top:0;left:0;position:fixed; z-index:3; cursor:none; border:0;" onMouseMove="javascript:getxy('land_0');" oncontextmenu="opnCntMenu()"></canvas>
	
	</div>



	<div id="CHAT_CP" style="opacity: 0.5;">
	
		<div id="ctBG" style="background:#fff;z-index:0; position:absolute; display:none; width:100%; height:100%;"></div>
		
		<div id="BOTBAR" onclick='javascript: getId(this.id);' style="position:fixed;bottom:0; width:1400px; height:0%; padding-top:4px;padding-bottom:4px; padding-right:0px; padding-left:0px; left:0; display:block; background:; z-index:120;">

			<div class="accordion" id="fullChatPanel" style="left:0;float:left;bottom:28px;position:absolute;" >
				<span style="color:#999999">&#8801;</span> INFO CHAT <span id="chatnew"></span> 
				<span onclick='javascript:fullChatOPN();return false' id="chatOC" style="float:right;padding-right:6px; z-index:1000;"><span style="color:#999999">&#10064;</span></span>		
			</div>				
		</div>

		
		<div id="FORUM" style="display:none;z-index:100; background:; width:100%; left:0;float:left;bottom:28px;position:absolute;">		
			<table style="background:; width:100%; left:0;float:left;bottom:0;position:absolute;">
				<td>
					<div class="mesChat" id="mesChat" style="position:fixed;top:0px; left:0;float:left; padding-top:2px;padding-left:4px;  padding-right:16px;display:block;background:#fff;width:100%;height:360px;overflow-y:auto;z-index:260;font-size: 12px;"></div>
				</td>
			</table>
					
			<table id="chatP" style="width:100%; left:0;float:left;bottom:0;position:absolute; z-index:100;background:#fff;">		
				<td>				
					<input type="text" id="sendMessageBox" style="width:50%;height:24px; margin-bottom:4px;margin-left:8px; padding: 2px 10px;" placeholder="Enter a message..." autofocus="true">
					<button type="button" id="sendButton" class="mBtn" style="width:120px;">SEND</button>
					<button type="button" id="clearMsgsButton" class="mBtn" style="width:40px;">&#10006;</button>
				</td>
			</table>			
		</div>

	</div>	


	
	<div id="BLOG_CP" style="display:none;">

		<div id="BOTBAR_1" onclick='javascript: getId(this.id);' style="position:fixed;bottom:0; width:1400px; height:0%; padding-top:4px;padding-bottom:4px; padding-right:0px; padding-left:0px; left:0; display:block; background:; z-index:120;">

			<div class="accordion" style="left:0;float:left;bottom:28px;position:absolute;" >BLOG <span id="chatnew"></span> </div>	
	
		</div>

		<div id="FORUM_1" style="z-index:1000;display:none; background:#fff; width:100%; height:202px; left:0;float:left;bottom:28px;position:absolute;">		
			
			<div style="display:block;position:relative;float:left; width:78%; padding:10px;">
			
				<input type="text" id="sBlogTitle" placeholder="Enter a title..." autofocus="true" style="width:84%; height:24px; padding:6px; margin-bottom:10px; white-space: pre-wrap; min-width: 1px;">
	
				<textarea type="text" id="sBlogCnt" placeholder="Enter a content..." autofocus="true" style="width:84%; height:120px; padding:6px; font:normal 1.4em verdana, arial, tahoma, sans-serif; white-space: pre-wrap; min-width: 1px;"></textarea>

				
				<div style="display:block;position:absolute;float:right;width:1%;top:6px;left:100%;padding-left:10px;">
				<button type="button" id="blogBTN" style="display:block;position:relative; width:120px; height:184px; left:100%; padding-left:2px;margin-left:2px;margin-top:4px;margin-bottom:4px;float:right;">SAVE POST</button>	
				</div>				
			
		    </div>
			
		</div>
		
	</div>	

	
	
	<p id="rounded"></p>
	<div class="cursor pointed"><div>


	<div id="select-resize" style="display:none;" class='resizable'>
		<div class='resizers'>
			<div id='resiz_info' style="padding-left:10px;">POS: W: H: X: Y:</div>
			<button style="padding:2px;height:22px" onclick='javascript: creatSizeBLOCK();' class="accordion">CREAT [NEW]</button>
				
			<button class="accordion" style="padding:2px;height:22px">TEXT</button>
			<div class="panel">			
				<span style="width:100%;margin:0;top:0;padding:4px;background:#ffffff;display:block:position:absolute;float:left;">		
					<h1 contenteditable="true" class="wp-block wp-block-post-title block-editor-block-list__block editor-post-title editor-post-title__input rich-text" aria-label="Text box" role="textbox" aria-multiline="true" style="white-space: pre-wrap; min-width: 1px;" id="text_box_resize">Write text</h1>			
				</span>
			</div>
			
			<button class="accordion" style="padding:2px;height:22px">IMAGE</button>
			<div class="panel">			
				<input type="file" id="imageLoader2" name="imageLoader2" class="imageLoader2"/>
			</div>

			<button style="padding:2px;height:22px" onclick='javascript: closeRSB();' class="accordion">CLOSE [X]</button>

			<div class='resizer top-left'></div>
			<div class='resizer top-right'></div>
			<div class='resizer bottom-left'></div>
			<div class='resizer bottom-right'></div>
			
		</div>
	</div>

	<video id="myVideo" style="visibility: hidden;" controls="true" src=""></video>

</body>


<script type="text/javascript">
//Fullscreen | Game
var btnPS = document.getElementById('cm_13');
var cpBAR = document.getElementById("INFO-BAR");
var botBAR = document.getElementById("BOTBAR");	
var fsBAR = document.getElementById("fullscreen2");
var landM=document.getElementById("land_0");
var gcModel=document.getElementById("land_1");
var maneCan2=document.getElementById("FON");
var chatCP=document.getElementById("fullChatPanel");
var chatCP1=document.getElementById("CHAT_CP");
var mesCP = document.getElementById('mesChat');
var canvasVID = document.getElementById("canvas3");
var maneCAN = document.getElementById("container");


var myInterval;
function startGame()
{	
	if(gameStatus==0)
	{
		gameStatus=1; 
		btnPS.innerHTML="STOP <span style='font-size: 1.26em;'>&#9632;</span>";  
		myInterval = setInterval(function() {move("2");}, 20); 
		wX = availableScreenWidth;
		wY = availableScreenHeight;		
		cpBAR.style.display='none'; 
		cpBAR.style.width=300+"px";
		fsBAR.style.display="block";
		fsBAR.style.opacity = 0.3;	
		gcModel.style.width=wX+300+"px";
		maneCan2.style.width=wX+"px";
		chatCP.style.width=200+"px"; 
		chatCP.style.left=wX-520+"px";
		chatCP.style.opacity = 0.5;
		chatCP1.style.opacity = 0.5;
		canvasVID.style.width=wX+"px"; 
		//landM.style.width=wX+"px"; 
	}
	else
	{
		gameStatus=0; 
		wX = availableScreenWidth;
		gcModel.style.width=wX-300+"px";
		//gcModel.style.height=wY-300+"px";
		clearInterval(myInterval); 
		btnPS.innerHTML="PLAY &#9658;";
		cpBAR.style.display='block'; 
		fsBAR.style.display="none";
		chatCP1.style.opacity = 1.0;
		canvasVID.style.width=wX+"px";
		//landM.style.width=wX+"px"; 
	}
	setTimeout(() => {move(3);}, "100"); setTimeout(() => {move(1);}, "100");
}

var fullScr=0;
function fullScreen()
{	
	if(fullScr==0)
	{
		fullScr=1; 
		wX = availableScreenWidth;
		wY = availableScreenHeight;		
		cpBAR.style.display='none'; 
		cpBAR.style.width=300+"px";
		fsBAR.style.display="block";
		fsBAR.style.opacity = 0.3;		
		gcModel.style.width=wX+"px";
		maneCan2.style.width=wX+"px";
		chatCP.style.width=wX+"px";
		//chatCP.style.height=wY+"px"; 
		chatCP.style.left=wX-320+"px";
		mesCP.style.width=wX-20+"px";
		chatCP.style.opacity = 0.7;
		chatCP1.style.opacity = 0.7;
		canvasVID.style.width=wX+"px"; 
		//canvasVID.style.height=wY+"px"; 
		
		landM.style.width=wX+"px";
		//landM.style.height=wY+"px";
		//maneCAN.style.width=wX-300+"px";
	}
	else
	{
		fullScr=0; 
		wX = availableScreenWidth;
		wY = availableScreenHeight;
		gcModel.style.width=wX+"px";
		cpBAR.style.display='block'; 
		fsBAR.style.display="none";
		chatCP1.style.opacity = 1.0;
		canvasVID.style.width=wX+"px";
		//canvasVID.style.height=wY+"px"; 
		landM.style.width=wX+"px";
		//landM.style.height=wY-300+"px"; 
	}
	setTimeout(() => {move(3);}, "100"); setTimeout(() => {move(1);}, "100");
}



//GET VIDEO W H
var v = document.getElementById("myVideo");
var v2 = document.getElementById("canvas3");

v.addEventListener(
  "resize",
  (ev) => {
	vidWR = v.videoWidth;
	vidHR = v.videoHeight;
	
	let w = v.videoWidth;
	let h = v.videoHeight;

	if (w && h) {
	  v.style.width = w;
	  v.style.height = h;
	  
	  v2.width = w;
	  v2.height = h;	  
	}
  },
  false,
);



function zoomCAN(d){
		var element = document.getElementById("INFO-BAR");
		var xPosition = element.offsetLeft;
		var yPosition = element.offsetTop;
		
		var zoomBTN = document.getElementById("cm_11");
		var canD1 = document.getElementById("container");
		var canD2 = document.getElementById("canvas3");
		
		if(zoomD==0)
		{
			zoomD=1; var statusDR = "AUTO ZOOM";
		}
		else
		{
			zoomD=0;var statusDR = "ZOOM";
		}
		
		bodyLoadx();
		zoomBTN.innerHTML = statusDR;
}


function opnBRW()
{
	var SB = document.getElementById("SITE");
	var BB = document.getElementById("BROWSER-BAR");
	SB.style.display="block";
	BB.style.display="block";
}


function clsBRW()
{
	var SB = document.getElementById("SITE");
	var BB = document.getElementById("BROWSER-BAR");
	SB.style.display="block";
	BB.style.display="none";
}

var cursorRounded = document.getElementById('rounded');


//GET XY
function getXYP(mEvent)
{ 
	ex=mEvent.clientX;
	ey=mEvent.clientY;		
	var xxx=ex+1;
	var yyy=ey+1;
	ex=ex+6;
	ey=ey+6;
	document.getElementById("getXYP").innerHTML="MX= "+ex+" ; MY= "+ey;
	cursorRounded.style.left=xxx+"px";
	cursorRounded.style.top=yyy+"px";	
}


var dSW=0;
var dSH=0;
var dSX=0;
var dSY=0;	
var selID=1;
var fillS=0;
var cbmPOS=0;
var tABox = 0;

function cB(id,val) {
	var checkBox = document.getElementById(id);
	if(id=="cb1"){ if(checkBox.checked == true){fillS=1; } else {fillS=0;}  }
	if(id=="cb2"){ if(checkBox.checked == true){cbmPOS=1;} else {cbmPOS=0;} }
}


const canM = document.getElementById("container");
const ctxM = canM.getContext("2d");
const canM2 = document.getElementById("container2");
const ctxM2 = canM2.getContext("2d");


function circle(x){
	var maneColorX = document.getElementById("color_op").value;
	colorNX = maneColorX.slice(0, -2);
	if(fillS==1)
	{
		ctxM.clearRect(0, 0, canM.width, canM.height);
		ctxM.fillStyle = '#ffffff';
		ctxM.fill();
	}		
	ctxM.beginPath();
	if(cbmPOS==0)
	{
		ctxM.arc(dSX, dSY, dSW, dSH, dSH * Math.PI);
	}
	if(cbmPOS==1)
	{
		ctxM.arc(lastClickX, lastClickY, dSW, dSH, dSH * Math.PI);
	}
	ctxM.fillStyle = colorNX;
	ctxM.strokeStyle = colorNX;
	ctxM.strokeStyle = colorNX;
	ctxM.stroke();
	gCAN(1);
}


function rectangleD1(x){
	var maneColorX = document.getElementById("color_op").value;
	colorNX = maneColorX.slice(0, -2);
	if(fillS==2)
	{
		ctxM.clearRect(0, 0, canM.width, canM.height);
		ctxM.fillStyle = '#ffffff';
		ctxM.fill();
	}
	if(fillS==1)
	{
		ctxM.clearRect(0, 0, canM.width, canM.height);
		gCAN(2);
	}
	ctxM.beginPath();
	ctxM.lineWidth = 1;
	if(cbmPOS==0)
	{
		ctxM.fillStyle = '#ffffff';
		ctxM.rect(dSX, dSY, dSW, dSH);
		ctxM.fill();
	}
	if(cbmPOS==1)
	{
		ctxM.fillStyle = '#ffffff';
		ctxM.rect(lastClickX, lastClickY, dSW, dSH);
		ctxM.fill();
	}	
	ctxM.fillStyle = colorNX;
	ctxM.strokeStyle = colorNX;	
	ctxM.stroke();
}	


function line1(x){
	var maneColorX = document.getElementById("color_op").value;
	colorNX = maneColorX.slice(0, -2);
	ctxM.beginPath();
	ctxM.lineWidth = 1;		
	
	if(cbmPOS==0)
    {
	  ctxM.moveTo(dSX, dSY);
	  ctxM.lineTo(dSW, dSH);
    }
    if(cbmPOS==1)
    {
	  ctxM.moveTo(lastClickX, lastClickY);
	  ctxM.lineTo(dSW, dSH);
    }
	
	ctxM.moveTo(dSX, dSY);
	ctxM.lineTo(dSW, dSH);
	ctxM.strokeStyle = colorNX;
	ctxM.stroke();
	gCAN(3);
}	


function line2(x){
	var maneColorX = document.getElementById("color_op").value;
	colorNX = maneColorX.slice(0, -2);
	ctxM.beginPath();
	ctxM.lineWidth = 1;
	ctx.moveTo(dSW, dSX);
	ctx.lineTo(dSH, dSY);	
	ctxM.strokeStyle = colorNX;
	ctxM.stroke();
	gCAN(4);
}	


function textDraw(val) 
{
	var maneColorX = document.getElementById("color_op").value;
	var textBox = document.getElementById("text_box").value;
	colorNX = maneColorX.slice(0, -2);
	if(fillS==0)
	{
	ctxM.clearRect(0, 0, canM.width, canM.height);
	ctxM.fillStyle = '#ffffff';
	ctxM.fill();
	} 
	if(fillS==1)
	{
	ctxM.fillStyle = '#ffffff';
	ctxM.fill();
	} 

	ctxM.beginPath();
	ctxM.fillStyle = colorNX;
	ctxM.trokeStyle = colorNX;
	var x1 = 1;
	var x2 = dSH/10;
	ctxM.font = x2+"px serif"; 
	
	if(cbmPOS==0)
	{
		ctxM.fillText(textBox, dSX, dSY, dSW, dSH/10);
	}
	if(cbmPOS==1)
	{
		ctxM.fillText(textBox, lastClickX, lastClickY, dSW, dSH/10);
	}

	ctxM.stroke(); 
}


var lstN = 0;
var dotX1 = 0;
var dotY1 = 0;
var dotX2 = 0;
var dotY2 = 0;
var lastARRX = new Array();
var lastARRY = new Array();

function flatnessD1(x)
{
	lstN = lstN+1;
	lastARRX[lstN] = lastClickX;
	lastARRY[lstN] = lastClickY;
	
	var maneColorX = document.getElementById("color_op").value;
	colorTR = maneColorX.slice(0, -2);
	ctxM.beginPath();
	ctxM.clearRect(0, 0, canM.width, canM.height);
    ctxM.beginPath();
	ctxM.fillStyle = colorTR;
	lastClickX1 = lastARRX[x];
	lastClickY1 = lastARRY[x];
	lastClickX2 = lastARRX[2];
	lastClickY2 = lastARRY[2];
	document.getElementById("FLATNESS").innerHTML="FLATNESS: X1: "+lastClickX+" Y1: "+lastClickY+"X2: "+lastClickX1+" Y2: "+lastClickY1;
    ctxM.moveTo(lastClickX, lastClickY);
	ctxM.lineTo(lastClickX1, lastClickY1);
	ctxM.lineTo(dSX, dSY);
    ctxM.lineTo(dSW, dSH);
    ctxM.fill();
}	

function triangelD1(x){
	var maneColorX = document.getElementById("color_op").value;
	colorTR = maneColorX.slice(0, -2);
	ctxM.beginPath();
	ctxM.clearRect(0, 0, canM.width, canM.height);
    ctxM.beginPath();
	ctxM.fillStyle = colorTR;
    ctxM.moveTo(dSX, dSY);
    ctxM.lineTo(dSW, dSH);
    ctxM.lineTo(lastClickX, lastClickY);
    ctxM.fill();
}


//Scrolls X-Y-W-H
function getV(id,val){
	if(id=="w"){dSW=val;}
	if(id=="h"){dSH=val;}
	if(id=="x"){dSX=val;}
	if(id=="y"){dSY=val;}
	if(selID==1){rectangleD1(val);}
	if(selID==2){circle(val);}
	if(selID==3){line1(val);}
	if(selID==4){line2(val);}
	if(selID==5){textDraw(val); var txtbox_1 = document.getElementById("text_box").style.display = "block";}
	if(selID==6){flatnessD1(val);}
	if(selID==7){triangelD1(val);}
	var valres = document.getElementById(id+'_v').innerHTML=val;
}


//SELECT
var resS = document.getElementById('res');

function GetSelectedTextValue(education) {
	var sleTex = education.options[education.selectedIndex].innerHTML;
	var selVal = education.value;
	selID = selVal;
}


//NEW POST LIST AJAX
function newPostLIST(){ 
	q=1;
	var postData = q;
	var ajax = new XMLHttpRequest();
	ajax.open("GET",'http://localhost/chat.php?q='+q,true);
	ajax.setRequestHeader('Content-Type', 'text/plain');
	ajax.onreadystatechange=function() 
	{
		if(ajax.readyState == 4)
		{				
			var resultContent = ajax.responseText;
			var log = document.getElementById("chat");
			log.style.display='block';
			log.innerHTML = resultContent;
		}
	}
	ajax.send(postData);
}
//setInterval(() => newPostLIST(), 5000);


//CREATE DIV
var dn=0;
function creatDIV(){	
	dn = dn + 1;
	var ndiv = document.createElement("div");
	var newDivId = "div_"+dn;
	ndiv.setAttribute("id", newDivId);
	ndiv.style.width = "200px";
	ndiv.style.height = "200px";
	ndiv.style.background = "red";
	ndiv.style.color = "white";	
	ndiv.innerHTML = ey+" | "+ey+" | "+newDivId;
	ndiv.position = "absolute";
	ndiv.style.width = oZOOM+"px";
	ndiv.style.margintop = ey+"px";
	ndiv.style.marginleft = ex+"px";		
	document.getElementById("blueRect").appendChild(ndiv);
	//ndiv.insertBefore(newDivId,ndiv);	
}	



var zoomSTEP = 0;
var drawR = 0;
//Mouse wheel
var elem = document.getElementById("land_1"); //container //land_1

    if (elem.addEventListener) { 
      if ('onwheel' in document) { 
        // IE9+, FF17+
        elem.addEventListener("wheel", onWheel);
      } else if ('onmousewheel' in document) {
        // old
        elem.addEventListener("mousewheel", onWheel);
      } else {
        // Firefox < 17
        elem.addEventListener("MozMousePixelScroll", onWheel);
      }
    } else { // IE8-
      elem.attachEvent("onmousewheel", onWheel);
    }


    //IE8-
    function onWheel(e) { runingFun("onWheel");
      e = e || window.event;
      var delta = e.deltaY || e.detail || e.wheelDelta;
	  //obj zoom
      var info = document.getElementById('delta');
	  objectZOOM = info.innerHTML - delta/2;

	  //Slide time position
	  if(sliderStatus==1)
	    {
			slideTimePOS = info.innerHTML - delta/2;
			slideSec=slideTimePOS;
			if(slideSec<0){slideSec=0;}
			slideTimer(slideSec);
			info.innerHTML = slideSec;
		}	
		else
		{	
			xCOR = -info.innerHTML - delta/2;
			yCOR = +info.innerHTML - delta/2;
			x = Math.round(ex);
			y = Math.round(ey);
			//Background move
			var mainCanvas = document.getElementById("container");
			var drawingS = mainCanvas.toDataURL("image/jpeg", 1.0);

			if(canvasIMAGE=="./images/1.jpg" || drawR==1){canvasIMAGE=drawingS; drawR=1; canvasIMGW=1040; canvasIMGH=700;}else{canvasIMAGE=canvasIMAGE;}
			
			//ZOOM PLUS
			if(delta==-100)
			{
				if(objectZOOM<=0){objectZOOM=-objectZOOM;}else{objectZOOM=objectZOOM;}
				info.innerHTML = objectZOOM;
				var wZOOM=canvasIMGW+objectZOOM;
				var hZOOM=canvasIMGH+objectZOOM;
				canvasIMGW=wZOOM;
				canvasIMGH=hZOOM;
				imageInCanvas("container",canvasIMAGE,0,0,wZOOM,hZOOM);
				
			}
			//ZOOM MINUS
			if(delta==100)
			{
				if(objectZOOM<=0){objectZOOM=-objectZOOM;}else{objectZOOM=objectZOOM;}
				info.innerHTML = objectZOOM;
				
				if(objectZOOM<=0)
				{
					var wZOOM=canvasIMGW+objectZOOM;
					var hZOOM=canvasIMGH+objectZOOM;
					canvasIMGW=wZOOM;
					canvasIMGH=hZOOM;					
				}
				if(objectZOOM>=0)
				{
					var wZOOM=canvasIMGW-objectZOOM;
					var hZOOM=canvasIMGH-objectZOOM;
					canvasIMGW=wZOOM;
					canvasIMGH=hZOOM;
				}
				if(canvasIMGW>=0)
				{
					imageInCanvas("container",canvasIMAGE,0,0,wZOOM,hZOOM);
					canvasIMGW=wZOOM;
					canvasIMGH=hZOOM;
				}
			}
			document.getElementById("COR").innerHTML="DELTA: "+delta+" ;IMG: "+canvasIMGH+" Z: "+objectZOOM;
		}
	
      e.preventDefault ? e.preventDefault() : (e.returnValue = false);
    }

	
	
	
//DRUG AND DROP
var ball = document.getElementById("blueRect");
var mainCanvas2 = document.getElementById("container");

ball.onmousedown = function(e) { runingFun("ball.onmousedown");
  ball.style.position = 'absolute';
  moveAt(e);
  document.body.appendChild(ball);
  ball.style.zIndex = 10;
  function moveAt(e)
  { 
		runingFun("moveAt");
		ball.style.left = e.pageX - ball.offsetWidth / 2 + 'px';
		ball.style.top =  e.pageY - ball.offsetHeight / 2 + 'px';			
		var sposX = e.pageX - mainCanvas2.offsetWidth / 2;	
		var sposY = e.pageY - mainCanvas2.offsetHeight / 2;		
		if(sposX>200 && sposY>200)
		{		
			imageInCanvas("container",canvasIMAGE,sposX,sposY,canvasIMGW,canvasIMGH);
		}
		else
		{
			imageInCanvas("container",canvasIMAGE,sposX,sposY,canvasIMGW,canvasIMGH);
		}	
  }

  document.onmousemove = function(e) { runingFun("document.onmousemove");
	moveAt(e);
  };

  ball.onmouseup = function() { runingFun("ball.onmouseup");
	document.onmousemove = null;
	ball.onmouseup = null;
  };
}


ball.ondragstart = function() { runingFun("ball.ondragstart");
  return false;
};
	
	
	
//CONTEXT MENU	
var div1 = document.getElementById("container");
div1.addEventListener("contextmenu", (e) => {e.preventDefault()});
// Show hidden content:
function opnCntMenu() { 
	var divCM = document.getElementById("myDiv");
	divCM.style.top = ey+'px';
	divCM.style.left = ex+50+'px';
	divCM.style.visibility = "visible";
}

function clsCntMenu() { 
	var divCM1 = document.getElementById("myDiv");
	divCM1.style.visibility = "hidden";
}	
	
function gridCntMenu(){ 
		var linkCM = document.getElementById("cm_1");
		if(gridSET==0){gridSET=1; var statusCM = "FIXED GRID";}else{gridSET=0; var statusCM = "FREE GRID";}		
		linkCM.innerHTML = statusCM;
}


//SELECT ON CANVAS
const canSM = document.getElementById("container");
const ctxSM = canM.getContext("2d");

function resize(){
		ctxSM.clearRect(0, 0, 1040, 700);
		ctxSM.fillStyle = 'blue';
		ctxSM.rect(lastClickX, lastClickY, ex, ey);
		ctxSM.fill();
}

function stopResize(){
	window.removeEventListener('mousemove', resize);
}

function selectO(){
	window.addEventListener('mousemove', resize);
	window.addEventListener('mouseup', stopResize);
}

	

//GRID	
var gridM = 0;	
function offGrid(){ 		
		var newDiv2 = document.getElementById("container");	
		var gridOnOFF = document.getElementById("cm_4");
		if(gridM==0){gridM=1; var statusCM = "GRID ON"; newDiv2.className = 'myCanOFF';}else{gridM=0; var statusCM = "GRID OFF"; newDiv2.className = 'myCan';}		
		gridOnOFF.innerHTML = statusCM;			
}	
	
	
function penDraw(d){
		var linkDraw = document.getElementById("cm_3");
		if(d==1 && penD==0){penD = 1; var statusDR = "PEN";}else{penD = 0; var statusDR = "CUBE";}
		linkDraw.innerHTML = statusDR;
}
	
function cirDraw(d){
		var cirMD = document.getElementById("cm_5");
		if(d==1 && cirD==0){cirD = 1; var statC = "CIRKLE ON";}else{cirD = 0; var statC = "CIRKLE OFF";}
		cirMD.innerHTML = statC;
}
	

function lineDraw(d){
		var lineD = document.getElementById("cm_6");
		if(d==1 && startLine==0){startLine = 1; var statC = "LINE ON";}else{startLine = 0; var statC = "LINE OFF";}
		lineD.innerHTML = statC;
}

function eraserDraw(d){
		var eraserD = document.getElementById("cm_7");
		if(d==1 && eraserS==0){eraserS = 1; var statC = "ERASER ON";}else{eraserS = 0; var statC = "ERASER OFF";}
		eraserD.innerHTML = statC;
		doCan("eraser",ex-20,ey-20,40,40, '', "container");
}


//INFO
var nmst=0;
function FNCList(f)
{   
	/*
	var a = document.getElementsByTagName('div');
	var body=document.getElementsByTagName('body')[0];
	var newDiv = document.createElement('div');
	var firstDiv=document.getElementById('FNC_LIST');
	var firstElem=firstDiv.getElementsByTagName('div')[0];	
	var divNum = a.length;
	nmst=nmst+1;
	newDiv.className = 'class_'+divNum;
	newDiv.id = divNum;
	newDiv.style.backgroundColor = 'silver';
	newDiv.innerHTML = '<span onclick=remove('+divNum+');return false>FNC: '+f+'</span>';
	firstDiv.insertBefore(newDiv,firstElem)	
	//body.appendChild(newDiv);
	*/
}

function remove(id){ 
	runingFun("remove"); 
	var elemST = document.getElementById(id);
    elemST.parentNode.removeChild(elem)
}
	

//Running function
var funN=0;
var fncARR = new Array(funN);
var fncNARR= new Array(funN);
function runingFun(f){		
	funN = funN+1;
	FNCList (f);	
	for(n=0;n<10;n++)
	{
		fncARR[n]=f;
		var fn1 = fncARR[n];
		document.getElementById("RUNF").innerHTML="RUN: "+fn1+":"+funN;
	}		
}	
	
	

function doDOTcolor(fn,n,color)
{   
	runingFun("doDOTcolor"); 
	var c=document.getElementById("container");
	var ctx=c.getContext("2d");
	xz = canDOTARRX[n]; 
	yz = canDOTARRY[n];
	wz = canDOTARRW[n];
	hz = canDOTARRH[n];
	//reload dot
	if(fn==1)
	{
		ctx.beginPath();
		ctx.fillRect(xz,yz,wz,hz);
		ctx.fillStyle=colorN;
		ctx.fill();
	}
	//reload dot
	if(fn==2)
	{
		ctx.beginPath();
		ctx.fillRect(xz,yz,wz,hz);
		ctx.fillStyle=colorN;
		ctx.fill();
	}	
}	
	

	
//TIMER
function reloadCan(fn,n,color)
{   
	runingFun("reloadCan"); 
	var c=document.getElementById("container");
	var ctx=c.getContext("2d");
	if(fn==1)
	{
		xz = canDOTARRX[n]; 
		yz = canDOTARRY[n];
		wz = canDOTARRW[n];
		hz = canDOTARRH[n];	
		doCan("reload", xz, yz,  wz, hz, colorN, "container");
		ctx.beginPath();
		ctx.fillRect(xz,yz,wz,hz);
		ctx.fillStyle=colorN;
		ctx.fill();			
	}
	//reload dot
	if(fn==2)
	{
		xz = canDOTARRX[n]; 
		yz = canDOTARRY[n];
		wz = canDOTARRW[n];
		hz = canDOTARRH[n];
		doCan("reload", xz, yz,  wz, hz, colorN, "container");
		
		ctx.beginPath();
		ctx.fillRect(xz,yz,wz,hz);
		ctx.fillStyle=colorN;
		ctx.fill();		
	}			
}	
	

var min=0;
var sec=0;	
var m=0;
var ss=0;	
var sliderStatus=0;		
function setCounter() 
{   
	if(stpTmr==1)
	{
		//sec
		if(sliderStatus==0){  s += 1; ss +=1; } 
		var timeZ = canDOTARR[s];
		if(timeZ>1){reloadCan(1,s,"black");}
		//min
		if(ss<=0){ss += 1;}
		if(ss>59)  {ss = 0; m +=1; }		
		document.getElementById("TIMER").innerHTML="mSec: "+s+"  sec: "+m;
		secZ=s;	
	}
}
var interval = setInterval(setCounter, 1);



//Reload	
function clearTimer(){
	s=0;	
	var c=document.getElementById("container");
	var ctx=c.getContext("2d");
	ctx.clearRect(0, 0, 1040, 700);	
	stpTmr=1;
	sliderStatus=0;
}
	
//Stop play	
function stopTimer(st)
{
	var playstopT = document.getElementById("stp_tmr");
	if(st==1 && stpTmr==0)
	{
		stpTmr = 1; 
		var statusSP = "PLAY";
	}
	else
	{
		stpTmr = 0; 
		var statusSP = "STOP";
	}
	playstopT.innerHTML = statusSP;
	sliderStatus=0;
}	


function nextTimer(){				
	sliderStatus=1;
	s = s+1;
	secZ=s+1;
	slideSec=s+1;
	xz = canDOTARRX[s]; 
	yz = canDOTARRY[s];
	wz = canDOTARRW[s];
	hz = canDOTARRH[s];
	var c=document.getElementById("container");
	var ctx=c.getContext("2d");
	ctx.clearRect(0, 0, 1040, 700);
	doCan("reload", xz, yz,  wz, hz, colorN, "container");	
	var timerSt = document.getElementById("TIMER");	
	timerSt.innerHTML = s;
}

function prevTimer(){				
	sliderStatus=1;
	s = s-1;
	secZ=s-1;
	slideSec=s-1;
	xz = canDOTARRX[s]; 
	yz = canDOTARRY[s];
	wz = canDOTARRW[s];
	hz = canDOTARRH[s];
	var c=document.getElementById("container");
	var ctx=c.getContext("2d");
	ctx.clearRect(0, 0, 1040, 700);
	doCan("reload", xz, yz,  wz, hz, colorN, "container");	
	var timerSt = document.getElementById("TIMER");	
	timerSt.innerHTML = s;
}


function slideTimer(n){				
	if(n==1){n=1;}
	n = n;		
	sliderStatus=1;
	s = n;
	secZ=n;
	stpTmr = 1;
	ss = s;
	slideSec=s;
	xz = canDOTARRX[n]; 
	yz = canDOTARRY[n];
	wz = canDOTARRW[n];
	hz = canDOTARRH[n];
	var c=document.getElementById("container");
	var ctx=c.getContext("2d");
	ctx.clearRect(0, 0, 1040, 700);
	doCan("reload", xz, yz,  wz, hz, colorN, "container");
}	
	

//SLIDER BAR
document.querySelectorAll('.range_box input').forEach(item => {
	item.addEventListener('click', function() {
		this.closest('.range_box').querySelector('.rangeValueTime').innerHTML = this.value;		
		var st = this.value;
		slideTimer(st);			
	})			
});	

	
//DOT SIZE	
document.querySelectorAll('.range_box input').forEach(item => {
		item.addEventListener('mousemove', function() {
			this.closest('.range_box').querySelector('.lineSizeV').innerHTML = this.value;		
			var dotsize = this.value;
			dotSizeW = dotsize;			
		})			
});		


var upMove=0;
document.querySelectorAll('.range_box input').forEach(item => {
		item.addEventListener('click', function() {
			this.closest('.range_box').querySelector('.canSizeV').innerHTML = this.value;		
			var cansize = this.value;
			cansize = Number(cansize);
			if(canSizeW>cansize){ upMove=1; }
			if(canSizeW<cansize){ upMove=-1; }
			canSizeW = cansize;	
			//Speed
			if(selID==1)
			{
				//wYM=canSizeW*100;
				if(upMove==1 && wYM>=9000) {wYM=canSizeW*100;}
				if(upMove==1 && wYM<9000)  {wYM=canSizeW*5;}
				if(upMove==-1 && wYM>0)    {wYM=canSizeW*100;}
				if(upMove==-1 && wYM<=0)   {wYM=canSizeW;}
				//if(wYM<=0){wYM=0;}
			}
			//Horizont line
			if(selID==2)
			{
				gL=canSizeW;
			}
			if(selID==3)
			{
				//Resize
				var canD1 = document.getElementById("container");
				var canD3 = document.getElementById("canvas3");
				canD3.style.width=cansize+"px";
				canD1.style.width=cansize+"px"; //Off to select 
			}
		})			
});		
	
	
	
//KEY EVENT
const blueRect = document.getElementById("blueRect");
const blueRectStyle = window.getComputedStyle(blueRect);

window.addEventListener("keydown", moveRect);
 
var xLeft=0;
var xRight=0; 
var yTop=0;
var yDown=0;
function moveRect(e){

    const left = parseInt(blueRectStyle.marginLeft); 
    const top = parseInt(blueRectStyle.marginTop);  
	
    switch(e.key){
	   
        case "ArrowLeft":
		    move(1);
            if(left>0)
                blueRect.style.marginLeft = left - 10 + "px";
				if(left>=0)  {xLeft = xLeft - 10;}else{xLeft = xLeft + 10;}
				blueRect.style.visibility="visible";
            break;
        case "ArrowUp":
			move(2);
            if(top>0)
                blueRect.style.marginTop = top - 10 + "px";
				if(top>=0){yTop = yTop - 10;}else{yTop = yTop + 10;}
				blueRect.style.visibility="visible";
            break;
        case "ArrowRight":
			move(3);
            if(left < document.documentElement.clientWidth - 100)
                blueRect.style.marginLeft = left + 10 + "px";
				if(left<=0)  {xLeft = xLeft -10;}else{xLeft = xLeft + 10;}
				blueRect.style.visibility="visible";
            break;
        case "ArrowDown":
			move(4);
            if(top < document.documentElement.clientHeight - 100)
                blueRect.style.marginTop = top + 10 + "px";	
				if(top<=0){yTop = yTop - 10;}else{yTop = yTop + 10;}
				blueRect.style.visibility="visible";
            break;
		case " ":
          doCan("click",xLeft+20,yTop+20,50,50, "black", "container");
            break;	
    }
		
	//COLLISION
	function collisionF(a,f)
	{	
		return (a.includes(f));
	}
	var colisX = collisionF(objARRX,left);
	var colisY = collisionF(objARRY,top);
	if (colisX===true && colisY===true){blueRect.style.backgroundColor = "red";}else{blueRect.style.backgroundColor = "blue";}
		
	var compass = document.getElementById("XYZ").innerHTML = "T: "+yTop+"L: "+xLeft+"COLL: "+colisX+"LEFT: "+left;
}




//WINDOWS ON LOAD AND RELOAD
const log = document.querySelector(".event-log-contents");
const reload = document.querySelector("#reload");

reload.addEventListener("click", () => {
  log.textContent = "";
  setTimeout(() => {
    window.location.reload(true);
  }, 200);
});

window.addEventListener("load", (event) => {});
document.addEventListener("readystatechange", (event) => {});
document.addEventListener("DOMContentLoaded", (event) => {});



//Resize default
var blcW=200;
var blcH=200;
var blcX=100;
var blcY=100;
//Resize 


//UPLOAD IMAGE FROM INPUT TO CANVAS
//POST MANE IMAGE
var imageLoader = document.getElementById('imageLoader');
imageLoader.addEventListener('change', handleImage, false);
var canvas = document.getElementById("container");
var ctx = canvas.getContext('2d');

var canvas3S = document.getElementById("canvas3"); //canvas3
var ctx22 = canvas.getContext('2d');

function restoreCan(){
	canvas.width = 1040;
	canvas.height = 700;
	canvas3S.width = 1040;
	canvas3S.height = 700;
}


function handleImage(e){
    var reader = new FileReader();
   reader.onload = function(event){
        var img = new Image();
        img.onload = function(){
        
		//canvas.width = img.width;
        //canvas.height = img.height;
			
		//var realW = img.width;
		//var realH = img.height;
		
		canvas3S.width=img.width;
		canvas3S.height=img.height;
		
		//alert("W: "+realW+"H: "+realH);
		
        ctx.drawImage(img,0,0);
        }		
        img.src = event.target.result; //base64		
		
		canvasIMAGE = img.src;
		canvasIMGW = img.width;
		canvasIMGH = img.height;
		imgName = canvasIMAGE;
		
		//AUTO SAVE ON SITE
		//setTimeout(() => saveIt(), 100);
		setTimeout(() => saveIt(6,0,0,0,0), 1000);
		//setTimeout(() => restoreCan(), 2000);
		
		
    }
        reader.readAsDataURL(e.target.files[0]);
		
		var imgF2="jpg";
		localStorage.setItem(keyID, "MAP:"+xS+":"+xSL+":"+ySL+":"+imgF2+":0");
		
}


//TEXT BOX IMAGE
var imageLoader2 = document.getElementById('imageLoader2');
imageLoader2.addEventListener('change', handleImage2, false);
var canvas2 = document.getElementById("container");
var ctx2 = canvas2.getContext('2d');


function handleImage2(e){
    var reader = new FileReader();
   reader.onload = function(event){
        var img = new Image();
        img.onload = function(){
        canvas2.width = img.width;
        canvas2.height = img.height;
        ctx2.drawImage(img,blcX,blcY,blcW,blcH);
        }		
        img.src = event.target.result; //base64		
		
		canvasIMAGE = img.src;
		canvasIMGW = img.width;
		canvasIMGH = img.height;
		imgName = canvasIMAGE;
		
		//AUTO SAVE ON SITE
		//setTimeout(() => saveIt(), 100);
    }
        reader.readAsDataURL(e.target.files[0]);  	
}



//APP tray icon NW
const win = nw.Window.get();

let tray = new nw.Tray({
title: 'SLOG BLOG',
icon: 'src/icon.png'
});

let menu = new nw.Menu();

let menuItems = [
{
  type: 'checkbox',
  label: 'EDIT'
},
{
  label: 'MESSAGE',
  click: function () {
	menu.popup(10, 10);
  }
},
{
  label: 'Exit',
  click: function () {
	win.close(true);
  }
}
];


menuItems.forEach(function (item) {
menu.append(new nw.MenuItem(item));
});

tray.menu = menu; 



//MENU ACCORDION
var acc = document.getElementsByClassName("accordion");
var i;

for (i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var panel = this.nextElementSibling;
        if (panel.style.display === "block") {
            panel.style.display = "none";
        } else {
            panel.style.display = "block";
        }
    });
}



//RESIZE
//Make resizable
const canRC = document.getElementById("container");
const ctxRC = canM.getContext("2d");
const resINFO = document.getElementById("resiz_info");
const selectResizeB = document.getElementById("select-resize");


var sizeS=20;
var sizeY=20;
function creatSizeBLOCK(){
	canLIST(blcX, blcY, blcW, blcH, "click", "container");
	var maneColorRS = document.getElementById("color_op").value;
	colorRS = maneColorRS.slice(0, -2);	
	
    var textBoxRS = document.getElementById("text_box_resize").innerHTML;

	ctx.beginPath();
	ctxRC.fillStyle = colorRS;
	ctxRC.rect(blcX, blcY, blcW, blcH);
	ctxRC.fill();
	
	ctxRC.beginPath();
	ctxRC.font = '18px calibri';
	ctxRC.fillStyle = 'white';
	let arr = textBoxRS.split('<div>');
	
	for (let i = 0; i < arr.length; i++)
	{
		if(i==0){sizeY = sizeS;}
		if(i>=1){sizeY = sizeY+sizeS;}
		
		let resnotags = arr[i].replace(/<!--[\s\S]*?--!?>/g, "").replace(/<\/?[a-z][^>]*(>|$)/gi, ""); // del html tags
		let textSTR = resnotags.replace(/&nbsp;/g, ' ');
		ctxRC.fillText(textSTR, blcX+20, blcY+sizeY, blcW, blcH);
	}
	ctxRC.troke();
}


function closeRSB(){
	selectResizeB.style.display="none";
	colorRS=0;
	blcW=0;
	blcH=0;
	blcX=0;
	blcY=0;
}


function selOpnBOX(){
	selectResizeB.style.display="block";
}

function clearCanvasRS(){
	ctxRC.clearRect(0, 0, 1040, 700);
}





var contX1=0; contY1=0; contX2=0; contY2=0; 
var fC=0; ff=0;

var globalSX = 0; globalSY = 0;
var logS=0;

//Peer object move
var objW=100; objH=100;  fX=0; fY=0;   zX=0; zY=0;  fM=0;  gX=0; gY=0; alertXY=0; stC=0; 

var zw=40; zh=40;
var stx=0; sty=0;
var onS=0;
var  stCX1=0; stCX2=0; stCY1=0; stCY2=0;

function globalBLOC(x,y,f1,f2){	
	//del(2);
	var gc=document.getElementById("land_1"); // land_0
	var ctxg=gc.getContext("2d");
	
	if(fX<x){fM="1";}if(fX>x){fM="3";}if(fY<y){fM="4";}if(fY>y){fM="2";}	
	fX=x; fY=y;
	
	if(contX1===undefined){fC="X1 EMPTY"+globalSX;}
	if(contX2===undefined){fC="X2 EMPTY"+globalSX;}
	if(contX1===undefined && contX2=== undefined){fC="EMPTY"+globalSX;}
		
	var lp = parseInt(blueRectStyle.marginLeft);
	var tp = parseInt(blueRectStyle.marginTop);
	
	//SENDER
	if(f2==2)
	{		
		var lp = parseInt(blueRectStyle.marginLeft);
		var tp = parseInt(blueRectStyle.marginTop);
			
		if(fM==1 || fM==3)
		{	
			//X
			if(xSL>contX1 && xSL<contX1+wX)  { stx=1; } //Over	
			if(xSL>contX1+wX)                { stx=2; } //Out
			if(xSL<contX1)                   { stx=3; } //Befor
			if(xSL<contX1 && xSL+wX<contX1)  { stx=4; } //Over	

			stC=stx;
			stCX1=stx;
		}	
		if(fM==2 || fM==4)
		{
			//Y
			if(contY1>=ySL && contY1>=ySL+wY)  { sty=11; }	
			if(contY1>=ySL && contY1<=ySL+wY)  { sty=22; }
			if(contY1<=ySL && contY1<=ySL-wY)  { sty=33; }
			if(contY1<=ySL && contY1<=ySL+wY)  { sty=44; }
			stC=sty;
			stCY1=sty;
		}
		
		var testinfo1 = document.getElementById("info_2").innerHTML="SENDER<br>X1: "+contX1+"Y1: "+contY1+"<br>X2: "+contX2+"Y2: "+contY2+"<br>XSL: "+xSL+"XSY: "+ySL+"<br>FUN: "+f1+" P2P CON: "+f2+" STC SEND: "+stC+" FULL: "+contX1+" | "+contX2+" LRUD: "+fM;
	}
	
	
	
	//RECEIVER
	if(f2==1)
	{
		var lp = parseInt(blueRectStyle.marginLeft);
		var tp = parseInt(blueRectStyle.marginTop);
		
		if(fM==1 || fM==3)
		{
			//X
			if(xSL>contX2 && xSL<contX2+wX)   { stx=11; } //Over	
			if(xSL>contX2+wX)                 { stx=22; } //Out
			if(xSL<contX2)                    { stx=33; } //Befor
			if(contX2>xSL+wX)                 { stx=33; } //Befor
			if(contX2>xSL && contX2>xSL+wX)   { stx=4; }
			
			stC=stx;
			stCX2=stx;
		}	
		if(fM==2 || fM==4)
		{
			//Y
			if(contY2>=ySL && contY2>=ySL+wY)  { sty=11; }	
			if(contY2>=ySL && contY2<=ySL+wY)  { sty=22; }
			if(contY2<=ySL && contY2<=ySL-wY)  { sty=33; }
			
			stC=sty;
			stCY2=sty;
		}

		var testinfo2 = document.getElementById("info_1").innerHTML="RECEIVER<br>X1: "+contX1+"Y1: "+contY1+"<br>X2: "+contX2+"Y2: "+contY2+"<br>XSL: "+xSL+"XSY: "+ySL+"<br>FUN: "+f1+"P2P CON:"+f2+" STC REC: "+stC+" FULL: "+contX1+" | "+contX2+" LRUD: "+fM;
	}
	
	
	if(f1==3)
	{
		del(0);
		ctxg.fillStyle="red";
		ctxg.fillRect(lp, tp, 40, 40);
	}
	if(f1==4)
	{
		del(0);
		ctxg.fillStyle="silver";
		ctxg.fillRect(lp, tp, 10, 10);
	}	
	if(f1==33)
	{
		del(0);
		ctxg.fillStyle="red";
		ctxg.fillRect(lp, tp, 40, 40);
	}		
	if(f1==1)
	{
		del(0);
		ctxg.fillStyle="black";
		ctxg.fillRect(lp, tp, 10, 10);
	}
	if(f1==11)
	{
		del(0);
		ctxg.fillStyle="green";
		ctxg.fillRect(lp, tp, 10, 10);
	}
	if(f1==22)
	{
		del(0);
		ctxg.fillStyle="purple";
		ctxg.fillRect(lp, tp, 10, 10);
	}	
	if(f1==2)
	{
		del(0);
		ctxg.fillStyle="silver";
		ctxg.fillRect(lp, tp, 40, 40);
	}	

	var testinfo3 = document.getElementById("info_3").innerHTML="stX: "+stx+"stY: "+sty+"  |  "+stCX1+" | "+stCX2+" | "+stCY1+" | "+stCY2+"  |  "+stC;
	
}



function lineObject(x,y){
	const c = document.getElementById("land_0");
	const ctx = c.getContext("2d");
	ctx.clearRect(0, 0, c.width, c.height); 
	ctx.beginPath();
	ctx.moveTo(x, y);
	ctx.lineTo(200, 100);
	ctx.stroke();
}



function del(id){	
	if(id==0)
	{
		var c0=document.getElementById("land_1");
		var ctx0=c0.getContext("2d");
		ctx0.clearRect(0, 0, c0.width, c0.height); 
	}	
	if(id==1)
	{
		var c=document.getElementById("container2");
		var ctx=c.getContext("2d");
		ctx.clearRect(0, 0, c.width, c.height); 
	}	
	if(id==2)
	{
		var c1=document.getElementById("land_0");
		var ctx1=c1.getContext("2d");
		ctx1.clearRect(0, 0, c1.width, c1.height); 
	}
}


function IsOdd(numb){
     var number = numb;
     if(Math.floor(number / 2) == number / 2) {
         //Odd
         return false;
     }else{
         //even
         return true;
     }
}





//FILE EXIST TEST 
function fileTest(f)
{
	const fs = require('fs');
	const pathToFileOrDir = f;
	// Check if the file or directory exists synchronously
	if (fs.existsSync(pathToFileOrDir)) {
	  //console.log(`The file or directory at '${pathToFileOrDir}' exists.`);
	  return true;
	} else {
	  //console.log(`The file or directory at '${pathToFileOrDir}' does not exist.`);
	  return false;
	}
}



//Random objects arr
const arrS = new Map(); 

//Image map
var map1="sky.png"; map2="road2.jpg";  map3="road.jpg"; map4="road2.jpg"; 
var monX=0; fC1=0; fC2=0;
var keyID=0; keyID1=0; keyID2=0;

var roundX2=0;
var rndX=0;
var statusMove=0;
var xzS=0;
var roundYS=0; //Slow speed background
var wXM=1040; wYM=9000;
var alp=0;
var fCNum=0;
var mYSlow=0;
var www=0; hhh=0; yyy=0;
var model='./map/model.png';
var soundL=0;
var gL = 352;
var savedY=0;

var xPOS=0; yPOS=0; wPOS=0; hPOS=0;



function move(xy)
{	
	xzS=xS;
	
	if(xy==1)
	{
		if(roundY<=1000){countSLY=savedY;}else{countSLY=0;}
		xy=1; xSL=xSL+stepSL; 
		stepSL=70;
		if(roundX<=wX) {roundX=roundX+stepSL;  rSL=roundX; countSLX=wX-roundX;} else {roundX=-wX; rSL=0; xS=xS-1;  }		
		if(roundX2<=wX){roundX2=roundX2+stepSL*2;} else {roundX2=-wX; oneStep=oneStep-1;} 
		if(countSLX>=wX && countSLX>=wY){if(zzT==2){rndX=rndX-1;}} else { if(zzT==1){rndX=rndX-1;}}	
	}		
	if(xy==2)
	{
		if(roundY<=1000){countSLY=savedY;}else{countSLY=0;}
		xy=2; ySL=ySL-stepSL; 
		//wYM=randRange (3000, 20000); //4000, 30000
		if(roundY<=wYM)  { roundY=roundY+400;  mYSlow=mYSlow+100;    rSL=roundX; countSLY=wY-roundY;}  else {roundY=-wY;  yS=yS+1; if(mYSlow>=wYM){mYSlow=0;  rSL=0;}}	
	}
	if(xy==3)
	{
		if(roundY<=1000){countSLY=savedY;}else{countSLY=0;}
		xy=3; xSL=xSL-stepSL; 
		if(roundX>=-wX) {roundX=roundX-stepSL; rSL=roundX; countSLX=wX-roundX;} else {roundX=wX;  rSL=0; xS=xS+1;} 
		if(roundX2>=-wX){roundX2=roundX2-stepSL*2;} else {roundX2=wX; oneStep=oneStep+1;} 
		if(countSLX>=wX && countSLX>=wY){if(zzT==2){rndX=rndX+1;}} else { if(zzT==1){rndX=rndX+1;}}	
	}
	if(xy==4)
	{
		if(roundY<=1000){countSLY=savedY;}else{countSLY=0;}
		xy=4; ySL=ySL+stepSL; 
		if(roundY>=-wY){roundY=roundY-stepSL; rSL=roundY; countSLY=wY-roundY;} else {roundY=wY;  rSL=0; yS=yS-1;} 
	}
	
	
	var c=document.getElementById("container");
	var ctx=c.getContext("2d");
	
	var gc=document.getElementById("land_0"); //land_0
	var ctxg=gc.getContext("2d");
	
	var gc1=document.getElementById("land_1"); //land_1 plane
	var ctxg1=gc1.getContext("2d");
	

	keyID = xS+"_"+yS;
	
	ctxg.globalAlpha = 0.7;
	
	var levX = localStorage.getItem(keyID);
	
	if(levX)
	{
		var FD = levX.split(':');					
		var fN = FD[0]; //POINT LEVEL
		var fX = FD[1]; //X
		var fY = FD[2]; //Y
		var fW = FD[3]; //W
		var fH = FD[4]; //H
		var fC = FD[5]; //C //ex
		var fM = FD[6]; //C //ey
	}
	
	fCNum = Number(fC);
	
	
	if(fN=="POINT")
	{
		var keyG = "KEY_"+keyID;
		var levID = localStorage.getItem(keyG);	
		ctxg.clearRect(0, 0, gc.width, gc.height);
		for (var i = 0; i < levID; i++) {
			if(i==0){var keyIDX = xS+"_"+yS;}else{var keyIDX = xS+"_"+yS+"_"+i;}
			var levP2 = localStorage.getItem(keyIDX);
			if(levP2!=null)
			{
				var FD = levP2.split(':');
				var fID = FD[6];  //ID
				var fX_i = FD[1]; //X
				var fY_i = FD[2]; //Y
				var fW_i = FD[3]; //W
				var fH_i = FD[4]; //H
				var fC = FD[5];   //C
				
				var x = parseInt(fX_i);	
				var y = parseInt(fY_i);	
				var idx = roundX+x;
				var idy = roundY+y;
				ctxg.fillStyle=fC;
				ctxg.fillRect(idx, idy, fW_i, fH_i);
			}
			else{}
		}	
	}

	
	if(fN=="SNAPSHOT")
	{
		make_base();
		ctxg.clearRect(0, 0, gc.width, gc.height); 		
		function make_base()
			{
				var base_image = new Image();
				base_image.src = fC;
				base_image.onload = function(){
				if(xy==1 || xy==3)
				{
					ctxg.drawImage(base_image, roundX, roundY+100, fW, fH);
				}
				if(xy==2)
				{
					var z = roundY/6;
					ctxg.drawImage(base_image, roundX+z, 300, fW/2+z, fH/2+z);
				}
				if(xy==4)
				{
					var z = roundY/6;
					ctxg.drawImage(base_image, roundX+z, 300, fW-z, fH-z);
				}

			}
		}
	}	
	
	
	//Plane	
	make_base3();
		

	if(fN)
	{
		//UD
		if(xy==2 || xy==4)
		{
			if(roundY>=0 && roundY<=700){ monX = "CENTER"; var mnX1 = "CENTER"; var mnX2 = "CENTER"; }
			var mnX1 = fX; var mnX2 = fX;
		}

		var num = Number(rndX);//fX
		var xx = IsOdd(num);
		
		if(xx==true){ subP="1"; }else{ subP="1/2"; xzS=xS+1; }	
		
		keyID2 = xzS+"_"+yS;
	
		if(xy==1 || xy==2 || xy==3 || xy==4)
		{
			if(fN=="MAP" || fN=="NEW")
			{
				if(fH=='png'){fC1='map/'+keyID+'.png'; fC2='map/'+keyID+'L.png';}
				if(fH=='jpg'){fC1='map/'+keyID+'.jpg'; fC2='map/'+keyID+'L.jpg';}
				if(fileTest(fC1)==true){make_base1();}else{}
				if(fileTest(fC2)==true){make_base2();}else{}				
			}
		}

		
		
				ctxg.clearRect(0, 0, wX, wY); 
				//ctxg.clearRect(0, 0, gc1.width, gc1.height); 


				function make_base1()
				{				  
						if(fN=="MAP" || fN=="NEW"){
							if(fH=='png')
							{
								fC1='map/'+keyID+'.png';  
								if(soundL!=keyID)
								{
									if(fC<300){soundClick("FX_L");}
									if(fC>300 && fC<800){soundClick("FX_CENTER_1");}
									if(fC>800){soundClick("FX_R");}
									//soundClick("SOUND_1");
									soundL=keyID; 
								} 
							}
							
							if(fH=='jpg'){fC1='map/'+keyID+'.jpg';}
						}
						
						var base_image1 = new Image();
						//var base_imageFAR = new Image();
						base_image1.src = fC1;
						
						/*Next frame
						var nextF=yS+1;
						keyIDFAR = xS+"_"+nextF;
						fCF1='map/'+keyIDFAR+'.png';
						base_imageFAR.src = fCF1;
						*/
						
						base_image1.onload = function(){
						if(xy==1 || xy==3)
						{
							savedY=roundY;
							//if(roundY==0){countSLY=savedY; roundY=savedY;}
							ctxg.globalAlpha = 0.7;
							
							var positiveNumberX = Math.abs(roundX);
							if(roundY<0 && xy==1){var XOS = Math.abs(roundX);}else{var XOS=roundX;}
							if(roundY<0 && xy==3){var XOS = Math.abs(-roundX);}else{var XOS=roundX;}
							
							if(xy==1 && roundX>=0){xPOS=xPOS+XOS/10;}
							if(xy==1 && roundX<0) {xPOS=-xPOS-XOS/10;}
							
							if(xy==3 && roundX>=0){xPOS=xPOS-XOS/10;}
							if(xy==3 && roundX<0){xPOS=xPOS+XOS/10;}
							//yPOS=yFMC/2-ey/200;
							//wPOS=wSize-ex/200;
							//hPOS=700+roundY/10;
							
							ctxg.drawImage(base_image1, xPOS, yPOS,  wPOS, hPOS);
							//ctxg.drawImage(base_image1, roundX, countSLY, 1040, 700);					
						}
						if(xy==2 || xy==4)
						{
							savedY=roundY;
							//Alpha
							if(roundY<4000)
							{ 
								//firstChar
								const a = roundY;
								const b = a.toString();
								alp = b[0];
								if(alp>=7){alp=8;}
								if(alp<=4){alp=5;}
								ctxg.globalAlpha = '0.'+alp*3;
							}
							if(roundY>=4000){ ctxg.globalAlpha = 0.8;}else{ctxg.globalAlpha = 0.9;}

							//Correction
							var cor1 = wX/1-roundY/25;

							if(fC!=undefined){ xFMC=fCNum+ex; }  else { xFMC=cor1/2-ex; }
							//if(fM!=undefined){ yFMC=fM-50; }  else { yFMC=-50+ey/400;} //org
							if(fM!=undefined){ yFMC=fM-100; }  else { yFMC=-50+ey;}
							//yFMC=-700;
							
							if(roundY<=0){var roundYaa=1000;}else{var roundYaa=ex;}

							if(roundY<700)
							{
								var wSize = 1040;
								var positiveNumber = Math.abs(roundY);
								if(roundY<0 && xy==2 ){var YOS = Math.abs(roundY);}else{var YOS=roundY;}
								
								xPOS=ex/2-YOS/125;
								yPOS=yFMC/2-ey/200;
								wPOS=wSize-ex/200;
								hPOS=700+YOS/10;
								
								ctxg.drawImage(base_image1,   xPOS, yPOS,  wPOS, hPOS); //org
								//ctxg.drawImage(base_imageFAR, xPOS, 200+yPOS/5,  wPOS/yPOS, hPOS/yPOS);
								//ctxg.drawImage(base_image1, ex, fM,  1040+roundY/ex, 700+roundY/5);
							}else
							{
								var wSize = 1040+roundY/25;								
								if(roundY<0){var YOS = Math.abs(roundY);}else{var YOS=roundY;}
								xPOS=ex/2-YOS/125;
								yPOS=yFMC/2-ey/200;
								wPOS=wSize-ex/200;
								hPOS=700+YOS/10;
								
								ctxg.drawImage(base_image1,   xPOS, yPOS,  wPOS, hPOS); //org
								//ctxg.drawImage(base_imageFAR, xPOS, 200+yPOS/5,  wPOS/yPOS, hPOS/yPOS);
								//ctxg.drawImage(base_image1, ex, fM,  1040+roundY/ex, 700+roundY/5);
							}
							
						}
					}
				}


				function make_base2()
				{
					if(fN=="MAP" || fN=="NEW"){
						if(fH=='png'){fC2='map/'+keyID+'L.png';}
						if(fH=='jpg'){fC2='map/'+keyID+'L.jpg';}
					}
					
					var base_image2 = new Image();
					base_image2.src = fC2;
					base_image2.onload = function()
					{
						if(xy==1 || xy==3)
						{
							savedY=roundY;
							//if(roundY==0){countSLY=savedY; roundY=savedY;}
							ctxg.globalAlpha = 0.7;
							ctxg.drawImage(base_image2, roundX, countSLY, 1040, 700);
						}
						
						if(xy==2 || xy==4)
						{
							savedY=roundY;
	
							if(roundY<=1500){ctxg.globalAlpha = 0.6; }else{ctxg.globalAlpha = 0.8;}

							//Correction
							var cor1 = wX/1-roundY/25;
							
							if(fC!=undefined){ xFMC=fCNum+ex; } else { xFMC=cor1/2-ex; }
							if(fM!=undefined){ yFMC=fM-50; }    else { yFMC=-50+ey/400;}
							//yFMC=-700;
							
							if(roundY<=0){var roundYaa=1000;}else{var roundYaa=ex;}
							
							if(roundY<700)
							{
								//ctxg.drawImage(base_image2,  ex,  yFMC-ey/2,  1040+roundYaa/20, 700+roundY/5); //Default 
								ctxg.drawImage(base_image2,  ex/2, yFMC-ey/200,  1040-ex/200, 700+roundY/10); //Default 
							}
							else
							{
								//ctxg.drawImage(base_image2,  ex,  yFMC-ey/2,  1040+roundYaa/20, 700+roundY/5); //Default
								ctxg.drawImage(base_image2,  ex/2, yFMC-ey/200,  1040-ex/200, 700+roundY/10); //Default
							}

						}
					}
				}				
	}	
		

		

				//MODEL	
				//ctxg1.clearRect(0, 0, gc1.width, gc1.height);
				ctxg1.clearRect(0, 0, wX, wY);
				if(canvasIMAGE==0){ model='./map/model.png'; }else{ model=canvasIMAGE;}			
				if(model=='./map/3D/MOD/6.png'){gameStatus=1; www=0; hhh=0;   }//Hand
				
				function make_base3()
				{				  
				
					var base_image3 = new Image();

					base_image3.src=model;
						
					base_image3.onload = function()
					{
						if(xy==1 || xy==3)
						{
							ctxg1.globalAlpha = 0.7;
							ctxg1.drawImage(base_image3, roundX, roundY, 1040, 700);					
						}
						
						if(xy==2 || xy==4)
						{
							ctxg1.globalAlpha = 0.7;
							
							//Z Move Gorizont 
							if(gameStatus==0)
							{
								www= 1040; hhh=700; yyy=-50; 
							}
							else
							{
								www=820; hhh=550;  
								if(ey>=600){yyy=0-ey/7;}
								if(ey<350 && ey>200) {yyy=0-ey/100;}
								if(ey<200) {yyy=100+ey/3;}
							}
							
							if(model=='./map/3D/MOD/6.png'){www=1040; hhh=700; yyy=-50;   }//Hand
							
							
							if(roundY<700)
							{
								ctxg1.drawImage(base_image3, wX/2-ex, yyy+ey/14, www+roundY/1130, hhh+roundY/1130); //Default
							}
							else
							{
								ctxg1.drawImage(base_image3, wX/2-ex, yyy+ey/14, www+roundY/1130, hhh+roundY/1130); //Default	
							}

						}
					}
				}	
		
		
		

	if(fN=="LINE")
	{		
		ctxg.clearRect(0, 0, c.width, c.height); 
		ctxg.beginPath();
		ctxg.moveTo(roundX, roundY+100);
		ctxg.lineTo(fX, fY);
		ctxg.stroke();
	}	

	
	if(fN==null)
	{
		ctxg.clearRect(0, 0, gc.width, gc.height); 
	}
	

	const imgL1 = new Image();
	const imgL2 = new Image();
	
	const imgU1 = new Image();
	const imgU2 = new Image();
	
	//Revers move size
	//if(countSLX>=wX && countSLX>=wY){brX1=0+roundX; brX2=roundX+wX;  zzT=1; } else {brX1=0+roundX; brX2=roundX-wX; zzT=2;}	
	if(countSLX>=wX && countSLX>=wY){brX1=0+roundX; brX2=roundX+wX;  zzT=1; } else {brX1=0+roundX; brX2=roundX-wX; zzT=2;}		
	if(gameStatus==0)
	{
		if(countSLX<=0 || countSLX<=0){brX1=0; brX2=wX*2;  zzT=1; }
		if(countSLX>=2800){brX1=0; brX2=wX*2;  zzT=1; }
	}
	
	
	//If 2 can on screen 
	//if(brX1==0 || brX2==0){brX1=roundX; brX2=roundX;}
	//if(brY1==0 || brY2==0){brY1=roundY; brY2=roundY;}
	
	

		//Left | Right
		if(xy==1 || xy==3)
		{			
			//Default
			var mapBG="img/fon.jpg";
			var mapBG1="img/roadLR.png";
			var mapBG2="img/roadLR.png";
			
			var mapBG3="img/sky1.png"; var mapBG4="img/sky1.png";
			
			var map1=mapBG1; map2=mapBG2;  map3=mapBG3; map4=mapBG4;
			
			roundY=saveY;
			//roundY=0;
			brY1=0; brY2=0;
			
			//ctx.globalAlpha = 0.1;
			
			imgL1.addEventListener("load", () => {
			
				//ctx.clearRect(0, 0, c.width, c.height);
				ctx.clearRect(0, 0, wX, wY); 
				ctx.globalAlpha = 0.8; //8
				
				//ctx.drawImage(imgU1, brX1, brY1, wX, wY);
				//ctx.drawImage(imgU2, brX2, brY1, wX, wY);
			
				//ctx.drawImage(imgL1, brX1, brY2+wY/2, wX, wY/2); //Road 1
				//ctx.drawImage(imgL2, brX2, brY2+wY/2, wX, wY/2); //Road 2
				ctx.drawImage(imgL1, brX1, 352, wX, wY/2); //Road 1
				ctx.drawImage(imgL2, brX2, 352, wX, wY/2); //Road 2

			});

			    /*
				//random block
				for(n=0;n<10;n++)
				{					
					if(rSL==0)
					{
						var rn = randRange (1, wX);
						var rN1 = arrS.get(keyID);
						if(rN1==undefined){arrS.set(keyID,rn);}
					}
					
						var randN1 = arrS.get(keyID);
						ctx.fillStyle="#000";
						if(n<5){ctx.fillRect(roundX/4+randN1, roundY/4+randN1, 3 , 3);}
						else{ctx.fillRect(roundX+randN1, roundY+randN1/2, 10 , 10);}
				}
				*/
				
		}	
		
		
		//Up | Down
		if(xy==2 || xy==4)
		{			
			var yM=roundY;
			
			if(countSLY>wY){zzT=3; brY1=0+yM; brY2=yM+wY;} else {zzT=4; brY1=yM; brY2=yM-wY;}			
			
			if(yM<0 && xy==2){yM=roundY-yM; roundY=0; } else {yM=yM; roundY=roundY;}		
			if(yM<0 && xy==4){yM=roundY-yM; roundY=0+roundY; } else {yM=yM; roundY=roundY;}			
			if(yM==0){brY1=0;}
			
			if(xS!=10)
			{					
					var mapBG2="img/road.png";					
					if(fN=="MAP" && zzT==fX){var mapBG='map/'+keyID+'_'+fX+'.jpg'; }									
					var map1="img/road.png"; map2="img/road2.png";  map3=mapBG2;  map4="img/road2.png";
				
					//Green land
					if((yS>=10 && yS<=14) || (yS>=26 && yS<=30)){map1="img/road2green.png"; map2="img/road2green.png"; map3="img/road2green.png"; map4="img/road2green.png"; }

					imgL1.addEventListener("load", () => {
					
						if(brY1<=1000)
						{
							ctx.globalAlpha = 0.1; 
							brY1=wX;
						}
						else{
							ctx.globalAlpha = 0.1;
						}

						//Gorizont line 352
						//gL = 352;
					
						if(flagON==1)
						{
							
							//Edit mode
							ctx.globalAlpha = 0.0; //0.4
							ctx.drawImage(imgU1, ex-brY1*4/2, gL+yM/1000,  brY1/2*8, 0+yM/2); //Original gorizont line
							ctx.globalAlpha = 0.0; //0.3
							ctx.drawImage(imgU2, ex-brY1*4/2, gL+yM/1000,  brY1/2*8, 0+yM/20); //Original gorizont line

							ctx.globalAlpha = 0.0; //1.0
							ctx.drawImage(imgL1, brX1, gL+yM/50, wX, wY/2);
							ctx.drawImage(imgL2, brX2, gL+yM/50, wX, wY/2);
							
						}						
						else
						{
							//Game mode
							ctx.globalAlpha = 0.2; //0.4
						    ctx.drawImage(imgU1, ex-brY1*4/2, gL+yM/1000,  brY1/2*8, 0+yM/2); //Original gorizont line
							ctx.globalAlpha = 0.2; //0.3
							ctx.drawImage(imgU2, ex-brY1*4/2, gL+yM/1000,  brY1/2*8, 0+yM/20); //Original gorizont line

							ctx.globalAlpha = 0.6; //0.6
							ctx.drawImage(imgL1, 0-ex,    gL, wX, wY/2);
							ctx.drawImage(imgL2, wX-ex, gL, wX, wY/2);
							
							
							
							//ctx.drawImage(imgU1, ex-brY1*4/5, 352+yM/50, wX, wY/2);
							//ctx.drawImage(imgU2, ex-brY2*4/5, 352+yM/50, wX, wY/2); 
						}
						
						
						
						/*
						ctx.globalAlpha = 0.9;
						ctx.drawImage(imgL1, brY1, 352+yM/50, wX, wY/2); //1 ORG
						ctx.drawImage(imgL2, brY2, 352+yM/50, wX, wY/2); //2 ORG						
						
						ctx.globalAlpha = 0.4;
						ctx.drawImage(imgU1, ex-brY1*4/2, 352+yM/1000,  brY1/2*8, 0+yM/2); //Original gorizont line
						ctx.globalAlpha = 0.3;
						ctx.drawImage(imgU2, ex-brY1*4/2, 352+yM/1000,  brY1/2*8, 0+yM/20); //Original gorizont line

						//ctx.globalAlpha = 0.9;
						//ctx.drawImage(imgL1, ex-brY1*4/2, 352+yM/50, wX, wY/2); //TEST 1
						//ctx.drawImage(imgL2, ex-brY1*4/2, 352+yM/50, wX, wY/2); //TEST 2
						
						//ctx.globalAlpha = 0.1;
						//ctx.drawImage(imgL1, ex-brY1*4/5, 352+yM/50, wX, wY/2);
						//ctx.drawImage(imgL2, ex-brY2*4/5, 352+yM/50, wX, wY/2); 
						*/

					});					
			}
			
			else
			
			{		
				imgL1.addEventListener("load", () => {
					/*
					ctx.drawImage(imgU1, brX1, brY1, wX, wY);
					ctx.drawImage(imgU2, brX2, brY1, wX, wY);
				
					ctx.drawImage(imgL1, brX1, brY2, wX, wY);
					ctx.drawImage(imgL2, brX2, brY2, wX, wY);
					*/
				});				
			}	
			
			
			    /*
				//random block
				for(n=0;n<10;n++)
				{
					var c_n=document.getElementById("container2");
					var ctx2=c_n.getContext("2d");
					
					if(rSL==0)
					{
						var rn = randRange (1, wX);
						var rN1 = arrS.get(keyID);
						if(rN1==undefined){arrS.set(keyID,rn);}
					}
						
						var randN1 = arrS.get(keyID);
						
						if(yS==3){ctx2.fillStyle="red";}else{ctx2.fillStyle="#000";}
						if(yS==4){ctx2.fillRect(ex, 0+roundY, roundY , 50);}
						
						if(n<5){ctx2.fillRect(ex, 300+roundY, roundY/randN1*20 , roundY/10);}
						else{ctx2.fillRect(ex+roundY-roundX+randN1, 300+roundY+randN1, 5 , 5);}
				}
				*/

		}

	var spd=2000-wYM/100; //Speed
	
	document.getElementById("LEV").innerHTML="X0:"+xSL+" Y0:"+ySL +"<br>X1: "+wX+" Y1: "+wY+"<br>X2: "+roundX+" Y2: "+roundY+"<br>X3: "+countSLX+" Y3: "+countSLY+"<br>LEVEL X:"+xS+"  LEVEL Y:"+yS +"<br>SCR:"+zzT+" | XY RUN:"+levX+"<br>POS: "+monX+"<br>STEP:"+oneStep+" | "+oneStep1+" | "+oneStep2+" | "+statusMove+" ROUND: "+rndX+" GRID: "+subP+"   ALP: "+alp+"<br>fH: "+fH+" fC: "+fC+" fM: "+fM+" xF: "+xFMC+"| yF: "+yFMC+"<br>TARGET: <b>"+bonus+"</b>"+"<br>SIZE:"+wYM/10+" | SPEED:"+spd+"<br>YS"+savedY; //+"<br>IMG:"+fC1+" | "+fC2+"<br>M1: "+mapBG1+" M2: "+mapBG2;
	
	
	//Slide img
	if(xy==1)
	{			
		imgL1.src = map1; imgL2.src = map2; imgU1.src = map3; imgU2.src = map4;
	}

	if(xy==3)
	{		
		imgL1.src = map1; imgL2.src = map2; imgU1.src = map3; imgU2.src = map4;
	}
		
	if(xy==2)
	{
		imgL1.src = map1; imgL2.src = map2; imgU1.src = map3; imgU2.src = map4;
	}
	if(xy==4)
	{
		imgL1.src = map1; imgL2.src = map2; imgU1.src = map3;imgU2.src = map4;
	}
}


//setTimeout(() => {move(3);}, "100"); setTimeout(() => {move(1);}, "100");



function altMsg(f,msgA){
	var msgAlt = document.getElementById("altMsg");
	msgAlt.style.position="fixed";
	msgAlt.style.zIndex=100;
	msgAlt.style.backgroundColor="#fff";
	msgAlt.style.top=ey+"px";
	msgAlt.style.left=ex+"px";
	if(f==1)
	{
		//setTimeout(() => {msgAlt.style.dislpay="block"; msgAlt.innerHTML=msgA;}, "1000");	
		msgAlt.style.dislpay="block"; msgAlt.innerHTML=msgA;
	}
	if(f==0)
	{
		msgAlt.style.dislpay="none"; msgAlt.innerHTML='';
	}
}






//P2P SERVER
var testID = document.getElementById("TEST_INFO");

loadJavaScriptSync("Reciever/peerjs.min.js");		
loadJavaScriptSync("src/p2p.js");		



var zoomD=0;
function bodyLoadx()
{
	
	wX = availableScreenWidth;
	wY = availableScreenHeight;	
	const canvas1 = document.getElementById('container');
	const canvas2 = document.getElementById('container2');
	const canvas3 = document.getElementById('canvas3');
	const canvas4 = document.getElementById('land_1');
	const canvas5 = document.getElementById('land_0');
	canvas1.width = wX; canvas1.height = wY;
	canvas2.width = wX; canvas2.height = wY;
	canvas3.width = wX; canvas3.height = wY;
	canvas4.width = wX; canvas4.height = wY;
	canvas5.width = wX; canvas5.height = wY;
	
	
	var win = window,
    doc = document,
    docElem = doc.documentElement,
    body = doc.getElementsByTagName('body')[0],
    xBW = win.innerWidth || docElem.clientWidth || body.clientWidth,
    yBH = win.innerHeight|| docElem.clientHeight|| body.clientHeight;	
	
	var element = document.getElementById("INFO-BAR");
	var xPosition = element.offsetLeft;
	var yPosition = element.offsetTop;
	
	setTimeout(() => {move(3);}, "100"); setTimeout(() => {move(1);}, "100");

	//test full chat
	var element2 = document.getElementById("BOTBAR");
	var messageCP2 = document.getElementById('mesChat');
	var yPosition2 = element2.offsetTop;
	messageCP2.style.height=yPosition2-60+"px";
	
	var BRB = document.getElementById("BROWSER-BAR");
	var mC = document.getElementById("BOTBAR");
	var mC1 = document.getElementById("BOTBAR_1");
	var forumB = document.getElementById("FORUM_1");
	var mesChat = document.getElementById("mesChat");
	var chatP = document.getElementById("chatP");
	var vidArea = document.getElementById("canvas3");
	
	//Video area size
	if(vidHR >= 1040)
	{
		vidArea.style.width=xPosition-20+"px";
		vidArea.style.height=yPosition-20+"px";
	}
		
	BRB.style.width=xPosition-20+"px";
	mesChat.style.width=xPosition-20+"px";
	chatP.style.width=xPosition+"px";
	mC.style.width=xPosition-20+"px";
	mC1.style.width=xPosition-20+"px";
	forumB.style.width=xPosition+"px";
	
	var canD1 = document.getElementById("container");
	var canD2 = document.getElementById("canvas3");
	if(zoomD==0)
	{
		//alert(1);
	}
	else
	{
		canD2.style.width=xBW-xPosition/xPosition-322+"px";
	}
	
}


var body = document.getElementsByTagName("body")[0];
body.addEventListener("load", init(), false);

function init() {
		bodyLoadx();
};

var bodyMain = document.getElementById("main");
window.addEventListener("resize", bodyLoadx);
	


var element = document.getElementById("INFO-BAR");
var xPosition = element.offsetLeft;
var yPosition = element.offsetTop;

setInterval(function() 
{
	//test full chat
	var element2 = document.getElementById("BOTBAR");
	var messageCP2 = document.getElementById('mesChat');
	var yPosition2 = element2.offsetTop;
	messageCP2.style.height=yPosition2-60+"px";
}, 30000);	
	


setTimeout(() => {move(3);}, "100"); setTimeout(() => {move(1);}, "100");	
	

/*	
// Set window to fullscreen on startup
var ngui = require('nw.gui');
var nwin = ngui.Window.get();

nwin.enterFullscreen();
//END

//Toggle Fullscreen--Borderless Window-Mode
nw.App.registerGlobalHotKey(new nw.Shortcut({
key: "F10",

active: function () {
nw.Window.get().toggleFullscreen();
}}));
//END
*/


</script>
</html>